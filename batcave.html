<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Bat Cave">
<meta name="theme-color" content="#0f1117">
<title>The Bat Cave</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><circle cx='50' cy='50' r='48' fill='%23FFB300'/><path d='M50 28C47 36,30 32,18 42C28 38,38 48,50 65C62 48,72 38,82 42C70 32,53 36,50 28Z' fill='%230f1117'/></svg>">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{
  --bg:#0f1117;--surface:#171b26;--surface2:#1e2336;--border:#2a3050;
  --text:#e8ecf4;--dim:#6b7a94;--gold:#FFB300;--amber:#FF8F00;
  --emerald:#00E676;--sky:#40C4FF;--coral:#FF6B6B;--violet:#B388FF;
  --rose:#F06292;--fb:#1877F2;--ig-pink:#E1306C;--ig-orange:#F77737;
  --ig-purple:#833AB4;
}
body.light-mode{
  --bg:#f4f5f7;--surface:#ffffff;--surface2:#eef0f4;--border:#d4d8e0;
  --text:#1a1a2e;--dim:#5a6478;--gold:#D4930D;--amber:#B87E0B;
  --emerald:#0d9e4f;--sky:#0288D1;--coral:#d44040;--violet:#7C4DFF;
  --rose:#c93a6d;--fb:#1877F2;--ig-pink:#E1306C;--ig-orange:#F77737;
  --ig-purple:#833AB4;
}
body.light-mode #topNav{background:linear-gradient(135deg,#ffffff,#f0f1f5);border-bottom-color:var(--border)}
body.light-mode .briefing{background:linear-gradient(135deg,#f0f2f8,#e8ebf2);border-color:rgba(212,147,13,0.25)}
body.light-mode .task-item:hover,body.light-mode .net-card:hover,body.light-mode .checklist-item:hover,body.light-mode .vault-entry:hover,body.light-mode .content-idea:hover{background:#e4e7ee}
body.light-mode .modal-overlay{background:rgba(0,0,0,0.4)}
body.light-mode .alfred-header .alfred-avatar{box-shadow:0 4px 20px rgba(212,147,13,0.15)}
body.light-mode .streak-bar{background:linear-gradient(135deg,rgba(212,147,13,0.1),rgba(212,147,13,0.04));border-color:rgba(212,147,13,0.2)}
body.light-mode .outreach-bar,body.light-mode .goal-progress{background:rgba(0,0,0,0.06)}
body.light-mode .tm-countdown{background:linear-gradient(135deg,#f0f2f8,#e8ebf2);border-color:rgba(212,147,13,0.25)}
body.light-mode .learn-card{background:linear-gradient(135deg,#ffffff,#f4f5f9);border-color:var(--border)}
body.light-mode .chat-msg.user{background:linear-gradient(135deg,rgba(212,147,13,0.12),rgba(212,147,13,0.06));border-color:rgba(212,147,13,0.2)}
body{font-family:'Inter',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;-webkit-tap-highlight-color:transparent}
button,a,.task-check,.checklist-item,.cl-check{-webkit-tap-highlight-color:transparent;touch-action:manipulation}
a{color:var(--gold);text-decoration:none}
a:hover{color:var(--amber)}

/* NAV */
#topNav{position:fixed;top:0;left:0;right:0;height:56px;background:linear-gradient(135deg,#12141f,#1a1e30);border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;padding:0 24px;z-index:1000;backdrop-filter:blur(10px)}
.nav-brand{display:flex;align-items:center;gap:10px;font-weight:800;font-size:16px;letter-spacing:2px;color:var(--gold);text-transform:uppercase}
.nav-brand svg{filter:drop-shadow(0 0 6px rgba(255,179,0,0.4))}
.nav-links{display:flex;gap:4px}
.nav-links a{padding:8px 16px;border-radius:8px;font-size:13px;font-weight:600;color:var(--dim);cursor:pointer;transition:all .2s;position:relative}
.nav-links a:hover{color:var(--text);background:rgba(255,179,0,0.08)}
.nav-links a.active{color:var(--gold);background:rgba(255,179,0,0.12)}
.nav-links a.active::after{content:'';position:absolute;bottom:0;left:50%;transform:translateX(-50%);width:20px;height:2px;background:var(--gold);border-radius:2px}
.gear-btn{background:none;border:none;color:var(--dim);font-size:20px;cursor:pointer;padding:8px;border-radius:8px;transition:all .2s}
.gear-btn:hover{color:var(--gold);background:rgba(255,179,0,0.1)}

/* MAIN */
main{padding:72px 24px 24px;max-width:900px;margin:0 auto}
.view{display:none}
.view.active{display:block}

/* CARDS */
.card{background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:20px;margin-bottom:16px}
.card-glow{box-shadow:0 0 20px rgba(255,179,0,0.06)}
.card h3{font-size:15px;font-weight:700;margin-bottom:12px;display:flex;align-items:center;gap:8px}
.card-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}
.section-title{font-size:22px;font-weight:800;margin-bottom:20px;display:flex;align-items:center;gap:10px}
.section-title .icon{font-size:24px}

/* BRIEFING */
.briefing{background:linear-gradient(135deg,#1a1e30,#252a42);border:1px solid rgba(255,179,0,0.2);border-radius:14px;padding:24px;margin-bottom:20px;position:relative;overflow:hidden}
.briefing::before{content:'';position:absolute;top:-30px;right:-30px;width:100px;height:100px;background:radial-gradient(circle,rgba(255,179,0,0.1),transparent);border-radius:50%}
.briefing .greeting{font-size:13px;color:var(--gold);font-weight:700;letter-spacing:1px;text-transform:uppercase;margin-bottom:8px}
.briefing .msg{font-size:15px;line-height:1.6;color:var(--text)}

/* TASKS */
.task-item{display:flex;align-items:center;gap:12px;padding:12px 16px;border-radius:10px;background:var(--surface2);margin-bottom:8px;transition:all .2s}
.task-item:hover{background:#262b40}
.task-item.completed{opacity:0.5}
.task-item.completed .task-text{text-decoration:line-through}
.task-check{width:20px;height:20px;border-radius:6px;border:2px solid var(--border);cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s;flex-shrink:0}
.task-check:hover{border-color:var(--gold)}
.task-check.checked{background:var(--emerald);border-color:var(--emerald)}
.task-check.checked::after{content:'✓';color:#fff;font-size:12px;font-weight:700}
.task-text{flex:1;font-size:14px}
.task-tag{font-size:11px;padding:2px 8px;border-radius:4px;font-weight:600}
.tag-pipeline{background:rgba(64,196,255,0.15);color:var(--sky)}
.tag-social{background:rgba(240,98,146,0.15);color:var(--rose)}
.tag-outreach{background:rgba(255,179,0,0.15);color:var(--gold)}
.tag-manual{background:rgba(179,136,255,0.15);color:var(--violet)}
.hq-btn{padding:4px 10px;border-radius:6px;border:1px solid rgba(64,196,255,0.3);background:rgba(64,196,255,0.08);color:var(--sky);font-size:11px;font-weight:600;cursor:pointer;transition:all .2s;white-space:nowrap}
.hq-btn:hover{background:rgba(64,196,255,0.2)}

/* OUTREACH COUNTERS */
.outreach-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-bottom:8px}
.outreach-item{text-align:center;padding:16px 8px;border-radius:10px;background:var(--surface2)}
.outreach-label{font-size:11px;font-weight:600;color:var(--dim);text-transform:uppercase;letter-spacing:.5px;margin-bottom:8px}
.outreach-count{font-size:28px;font-weight:800;margin-bottom:8px}
.outreach-count.emails{color:var(--gold)}
.outreach-count.calls{color:var(--emerald)}
.outreach-count.dms{color:var(--sky)}
.outreach-bar{height:4px;border-radius:2px;background:rgba(255,255,255,0.06);overflow:hidden;margin-bottom:8px}
.outreach-fill{height:100%;border-radius:2px;transition:width .4s ease}
.outreach-btns{display:flex;gap:4px;justify-content:center}
.outreach-btns button{width:28px;height:28px;border-radius:6px;border:1px solid var(--border);background:var(--surface);color:var(--text);font-size:14px;cursor:pointer;transition:all .2s;display:flex;align-items:center;justify-content:center}
.outreach-btns button:hover{border-color:var(--gold);color:var(--gold)}

/* STREAK */
.streak-bar{display:flex;align-items:center;gap:12px;padding:16px 20px;border-radius:10px;background:linear-gradient(135deg,rgba(255,179,0,0.08),rgba(255,179,0,0.02));border:1px solid rgba(255,179,0,0.15)}
.streak-fire{font-size:24px;animation:pulse 2s infinite}
.streak-num{font-size:24px;font-weight:800;color:var(--gold)}
.streak-label{font-size:13px;color:var(--dim)}
@keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.15)}}

/* GOAL BAR */
.goal-bar{display:flex;align-items:center;gap:16px;padding:16px 20px;border-radius:10px;background:var(--surface2);margin-top:12px}
.goal-bar .goal-text{font-size:13px;color:var(--dim)}
.goal-bar .goal-text strong{color:var(--emerald);font-size:16px}
.goal-progress{flex:1;height:6px;border-radius:3px;background:rgba(255,255,255,0.06);overflow:hidden}
.goal-progress .fill{height:100%;border-radius:3px;background:linear-gradient(90deg,var(--emerald),var(--gold));transition:width .5s}

/* ALFRED */
.alfred-header{text-align:center;padding:24px;margin-bottom:16px}
.alfred-avatar{width:80px;height:80px;border-radius:50%;background:linear-gradient(135deg,var(--gold),var(--amber));display:flex;align-items:center;justify-content:center;font-size:36px;margin:0 auto 12px;box-shadow:0 4px 20px rgba(255,179,0,0.2)}
.alfred-name{font-size:18px;font-weight:700;color:var(--gold)}
.alfred-title{font-size:13px;color:var(--dim)}
.chat-box{height:400px;overflow-y:auto;padding:16px;background:var(--surface);border:1px solid var(--border);border-radius:12px 12px 0 0;display:flex;flex-direction:column;gap:12px}
.chat-msg{max-width:80%;padding:12px 16px;border-radius:12px;font-size:14px;line-height:1.5;animation:fadeIn .3s}
.chat-msg.alfred{background:var(--surface2);border:1px solid var(--border);align-self:flex-start;border-bottom-left-radius:4px}
.chat-msg.user{background:linear-gradient(135deg,rgba(255,179,0,0.15),rgba(255,179,0,0.08));border:1px solid rgba(255,179,0,0.2);align-self:flex-end;border-bottom-right-radius:4px}
.chat-msg .sender{font-size:11px;font-weight:700;margin-bottom:4px}
.chat-msg.alfred .sender{color:var(--gold)}
.chat-msg.user .sender{color:var(--sky)}
.chat-input-row{display:flex;gap:8px;padding:12px;background:var(--surface);border:1px solid var(--border);border-top:none;border-radius:0 0 12px 12px}
.chat-input-row input{flex:1;background:var(--surface2);border:1px solid var(--border);border-radius:8px;padding:10px 14px;color:var(--text);font-size:14px;font-family:inherit}
.chat-input-row input:focus{outline:none;border-color:var(--gold)}
.chat-input-row button{padding:10px 20px;border-radius:8px;border:none;background:var(--gold);color:#000;font-weight:700;font-size:13px;cursor:pointer;transition:all .2s}
.chat-input-row button:hover{background:var(--amber)}
.quick-prompts{display:flex;flex-wrap:wrap;gap:8px;margin-top:12px}
.quick-prompts button{padding:8px 14px;border-radius:8px;border:1px solid var(--border);background:var(--surface);color:var(--dim);font-size:12px;font-weight:600;cursor:pointer;transition:all .2s}
.quick-prompts button:hover{color:var(--gold);border-color:var(--gold);background:rgba(255,179,0,0.05)}
@keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}

/* NETWORK */
.net-filters{display:flex;gap:8px;margin-bottom:16px;flex-wrap:wrap}
.net-filters button{padding:6px 14px;border-radius:8px;border:1px solid var(--border);background:var(--surface);color:var(--dim);font-size:12px;font-weight:600;cursor:pointer;transition:all .2s}
.net-filters button:hover,.net-filters button.active{color:var(--gold);border-color:var(--gold);background:rgba(255,179,0,0.08)}
.net-card{display:flex;gap:16px;padding:16px;border-radius:10px;background:var(--surface2);margin-bottom:10px;transition:all .2s}
.net-card:hover{background:#262b40}
.net-stars{color:var(--gold);font-size:12px;letter-spacing:2px}
.net-name{font-weight:700;font-size:15px}
.net-meta{font-size:12px;color:var(--dim);margin-top:2px}
.net-actions{display:flex;gap:6px;margin-top:8px}
.net-actions button{padding:4px 10px;border-radius:6px;border:1px solid var(--border);background:var(--surface);color:var(--dim);font-size:11px;font-weight:600;cursor:pointer;transition:all .2s}
.net-actions button:hover{color:var(--gold);border-color:var(--gold)}
.net-info{flex:1}
.net-alert{padding:12px 16px;border-radius:10px;background:rgba(255,107,107,0.08);border:1px solid rgba(255,107,107,0.2);margin-bottom:12px;display:flex;align-items:center;gap:10px;font-size:13px;color:var(--coral)}
.birthday-alert{background:rgba(255,179,0,0.08);border-color:rgba(255,179,0,0.2);color:var(--gold)}

/* LEARN */
.learn-card-container{position:relative;min-height:300px;display:flex;align-items:center;justify-content:center}
.learn-card{background:linear-gradient(135deg,var(--surface),var(--surface2));border:1px solid var(--border);border-radius:16px;padding:40px 32px;text-align:center;max-width:500px;width:100%;animation:cardIn .4s ease;position:relative}
.learn-card .cat-tag{display:inline-block;padding:4px 12px;border-radius:20px;font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:1px;margin-bottom:20px}
.learn-card .card-title{font-size:20px;font-weight:800;margin-bottom:16px;line-height:1.3}
.learn-card .card-body{font-size:15px;line-height:1.7;color:var(--dim);margin-bottom:24px}
.learn-card .save-btn{padding:8px 20px;border-radius:8px;border:1px solid var(--border);background:var(--surface);color:var(--dim);font-size:13px;font-weight:600;cursor:pointer;transition:all .2s}
.learn-card .save-btn:hover{color:var(--gold);border-color:var(--gold)}
.learn-card .save-btn.saved{color:var(--gold);border-color:var(--gold);background:rgba(255,179,0,0.1)}
.learn-nav{display:flex;justify-content:center;gap:16px;margin-top:20px}
.learn-nav button{padding:10px 24px;border-radius:8px;border:1px solid var(--border);background:var(--surface);color:var(--dim);font-size:13px;font-weight:600;cursor:pointer;transition:all .2s}
.learn-nav button:hover{color:var(--gold);border-color:var(--gold)}
.learn-counter{text-align:center;margin-top:12px;font-size:13px;color:var(--dim)}
.learn-tabs{display:flex;gap:6px;margin-bottom:20px;flex-wrap:wrap;justify-content:center}
.learn-tabs button{padding:6px 12px;border-radius:20px;border:1px solid var(--border);background:var(--surface);color:var(--dim);font-size:11px;font-weight:600;cursor:pointer;transition:all .2s}
.learn-tabs button:hover,.learn-tabs button.active{color:var(--gold);border-color:var(--gold);background:rgba(255,179,0,0.08)}
@keyframes cardIn{from{opacity:0;transform:scale(.95) translateY(10px)}to{opacity:1;transform:scale(1) translateY(0)}}
.cat-sales{background:rgba(255,179,0,0.15);color:var(--gold)}
.cat-network{background:rgba(179,136,255,0.15);color:var(--violet)}
.cat-growth{background:rgba(0,230,118,0.15);color:var(--emerald)}
.cat-comms{background:rgba(64,196,255,0.15);color:var(--sky)}
.cat-leadership{background:rgba(240,98,146,0.15);color:var(--rose)}
.cat-industry{background:rgba(255,107,107,0.15);color:var(--coral)}
.cat-social{background:rgba(24,119,242,0.15);color:var(--fb)}
.cat-mindset{background:rgba(255,143,0,0.15);color:var(--amber)}

/* SOCIAL */
.social-tabs{display:flex;gap:4px;margin-bottom:20px}
.social-tabs button{flex:1;padding:10px;border-radius:8px;border:1px solid var(--border);background:var(--surface);color:var(--dim);font-size:13px;font-weight:700;cursor:pointer;transition:all .2s}
.social-tabs button:hover{background:var(--surface2)}
.social-tabs button.active-ig{color:var(--ig-pink);border-color:var(--ig-pink);background:rgba(225,48,108,0.08)}
.social-tabs button.active-fb{color:var(--fb);border-color:var(--fb);background:rgba(24,119,242,0.08)}
.social-tabs button.active-li{color:#0A66C2;border-color:#0A66C2;background:rgba(10,102,194,0.08)}
.social-tabs button.active-ideas{color:var(--gold);border-color:var(--gold);background:rgba(255,179,0,0.08)}
.platform-launch{display:inline-flex;align-items:center;gap:8px;padding:10px 20px;border-radius:8px;font-weight:700;font-size:13px;cursor:pointer;transition:all .2s;border:none}
.platform-launch.li{background:#0A66C2;color:#fff}
.platform-launch.ig{background:linear-gradient(135deg,var(--ig-purple),var(--ig-pink),var(--ig-orange));color:#fff}
.platform-launch.fb{background:var(--fb);color:#fff}

/* VAULT */
.vault-entry{padding:16px;border-radius:10px;background:var(--surface2);margin-bottom:10px;transition:all .2s;cursor:pointer}
.vault-entry:hover{background:#262b40}
.vault-entry .ve-title{font-weight:700;font-size:15px;margin-bottom:6px}
.vault-entry .ve-preview{font-size:13px;color:var(--dim);line-height:1.5;margin-bottom:8px}
.vault-entry .ve-tags{display:flex;gap:4px;flex-wrap:wrap}
.vault-entry .ve-tag{padding:2px 8px;border-radius:4px;font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:.5px}
.vault-entry .ve-date{font-size:11px;color:var(--dim);margin-top:6px}
.vt-objection{background:rgba(255,107,107,0.15);color:var(--coral)}
.vt-email{background:rgba(255,179,0,0.15);color:var(--gold)}
.vt-script{background:rgba(64,196,255,0.15);color:var(--sky)}
.vt-insight{background:rgba(0,230,118,0.15);color:var(--emerald)}
.vt-lesson{background:rgba(179,136,255,0.15);color:var(--violet)}
.vt-idea{background:rgba(255,143,0,0.15);color:var(--amber)}
.vt-quote{background:rgba(240,98,146,0.15);color:var(--rose)}
.vt-competitor{background:rgba(24,119,242,0.15);color:var(--fb)}
.vault-full{padding:20px;background:var(--surface);border:1px solid var(--border);border-radius:12px;margin-bottom:16px}
.vault-full .vf-content{font-size:14px;line-height:1.7;white-space:pre-wrap;margin:16px 0}

/* TIME MACHINE */
.tm-countdown{text-align:center;padding:32px 20px;background:linear-gradient(135deg,#1a1e30,#252a42);border:1px solid rgba(255,179,0,0.2);border-radius:14px;margin-bottom:20px}
.tm-days{font-size:64px;font-weight:800;color:var(--gold);line-height:1}
.tm-days-label{font-size:14px;color:var(--dim);margin-top:4px;font-weight:600}
.tm-target{font-size:13px;color:var(--dim);margin-top:12px}
.tm-target strong{color:var(--gold)}
.tm-pace{padding:20px;border-radius:12px;margin-bottom:16px;text-align:center}
.tm-pace.ahead{background:rgba(0,230,118,0.08);border:1px solid rgba(0,230,118,0.2)}
.tm-pace.behind{background:rgba(255,107,107,0.08);border:1px solid rgba(255,107,107,0.2)}
.tm-pace.on-track{background:rgba(255,179,0,0.08);border:1px solid rgba(255,179,0,0.2)}
.tm-pace .pace-label{font-size:13px;font-weight:700;text-transform:uppercase;letter-spacing:1px}
.tm-pace.ahead .pace-label{color:var(--emerald)}
.tm-pace.behind .pace-label{color:var(--coral)}
.tm-pace.on-track .pace-label{color:var(--gold)}
.tm-pace .pace-detail{font-size:14px;color:var(--dim);margin-top:8px}
.tm-milestones{display:grid;grid-template-columns:repeat(4,1fr);gap:8px}
.tm-mile{padding:12px 8px;border-radius:8px;background:var(--surface2);text-align:center;font-size:12px}
.tm-mile .month-name{font-weight:700;margin-bottom:4px}
.tm-mile .month-target{font-size:18px;font-weight:800;color:var(--dim)}
.tm-mile.hit .month-target{color:var(--emerald)}
.tm-mile.current{border:1px solid var(--gold)}
.tm-mile.current .month-target{color:var(--gold)}
.tm-weekly{padding:16px;border-radius:10px;background:var(--surface2);margin-bottom:8px;display:flex;align-items:center;gap:16px}
.tm-weekly .tw-week{font-weight:700;font-size:13px;min-width:80px}
.tm-weekly .tw-bar{flex:1;height:6px;border-radius:3px;background:rgba(255,255,255,0.06);overflow:hidden}
.tm-weekly .tw-fill{height:100%;border-radius:3px;transition:width .4s}
.tm-weekly .tw-count{font-size:13px;font-weight:700;min-width:40px;text-align:right}
.platform-launch:hover{transform:translateY(-2px);box-shadow:0 4px 12px rgba(0,0,0,0.3)}
.checklist-item{display:flex;align-items:center;gap:12px;padding:10px 14px;border-radius:8px;background:var(--surface2);margin-bottom:6px;cursor:pointer;transition:all .2s}
.checklist-item:hover{background:#262b40}
.checklist-item.done{opacity:0.5}
.checklist-item.done .cl-text{text-decoration:line-through}
.cl-check{width:18px;height:18px;border-radius:5px;border:2px solid var(--border);display:flex;align-items:center;justify-content:center;transition:all .2s;flex-shrink:0}
.cl-check.checked{border-color:var(--emerald);background:var(--emerald)}
.cl-check.checked::after{content:'✓';color:#fff;font-size:10px;font-weight:700}
.cl-text{flex:1;font-size:13px}
.content-idea{padding:12px 16px;border-radius:8px;background:var(--surface2);margin-bottom:8px;cursor:pointer;transition:all .2s}
.content-idea:hover{background:#262b40}
.content-idea .idea-title{font-weight:700;font-size:14px;margin-bottom:4px}
.content-idea .idea-desc{font-size:12px;color:var(--dim)}
.content-idea .idea-platform{font-size:11px;color:var(--gold);margin-top:4px}

/* WINS */
.win-item{padding:14px 16px;border-radius:10px;background:var(--surface2);margin-bottom:8px;display:flex;align-items:flex-start;gap:12px}
.win-icon{font-size:20px;flex-shrink:0}
.win-body{flex:1}
.win-desc{font-size:14px;font-weight:600}
.win-meta{font-size:12px;color:var(--dim);margin-top:4px}
.win-cat{display:inline-block;padding:2px 8px;border-radius:4px;font-size:11px;font-weight:600;margin-left:8px}
.win-totals{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:16px}
.win-totals .wt{padding:8px 14px;border-radius:8px;background:var(--surface2);font-size:13px;font-weight:600}

/* MODALS */
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.7);z-index:2000;display:none;align-items:center;justify-content:center;backdrop-filter:blur(4px)}
.modal-overlay.active{display:flex}
.modal-box{background:var(--surface);border:1px solid var(--border);border-radius:14px;padding:28px;width:90%;max-width:500px;max-height:85vh;overflow-y:auto;animation:modalIn .3s}
@keyframes modalIn{from{opacity:0;transform:scale(.95)}to{opacity:1;transform:scale(1)}}
.modal-box h2{font-size:18px;font-weight:700;margin-bottom:20px;color:var(--gold)}
.form-group{margin-bottom:16px}
.form-group label{display:block;font-size:12px;font-weight:600;color:var(--dim);margin-bottom:6px;text-transform:uppercase;letter-spacing:.5px}
.form-group input,.form-group select,.form-group textarea{width:100%;padding:10px 14px;border-radius:8px;border:1px solid var(--border);background:var(--surface2);color:var(--text);font-size:14px;font-family:inherit}
.form-group input:focus,.form-group select:focus,.form-group textarea:focus{outline:none;border-color:var(--gold)}
.form-group textarea{resize:vertical;min-height:80px}
.form-row{display:flex;gap:12px}
.form-row .form-group{flex:1}
.btn{padding:10px 20px;border-radius:8px;border:none;font-weight:700;font-size:13px;cursor:pointer;transition:all .2s}
.btn-gold{background:var(--gold);color:#000}
.btn-gold:hover{background:var(--amber)}
.btn-outline{border:1px solid var(--border);background:var(--surface);color:var(--dim)}
.btn-outline:hover{border-color:var(--gold);color:var(--gold)}
.btn-danger{background:rgba(255,107,107,0.15);color:var(--coral);border:1px solid rgba(255,107,107,0.3)}
.btn-danger:hover{background:rgba(255,107,107,0.25)}
.btn-row{display:flex;gap:8px;justify-content:flex-end;margin-top:20px}

/* SEARCH */
.search-box{width:100%;padding:10px 14px;border-radius:8px;border:1px solid var(--border);background:var(--surface2);color:var(--text);font-size:14px;font-family:inherit;margin-bottom:16px}
.search-box:focus{outline:none;border-color:var(--gold)}

/* ADD TASK INPUT */
.add-task-row{display:flex;gap:8px;margin-top:12px}
.add-task-row input{flex:1;padding:10px 14px;border-radius:8px;border:1px solid var(--border);background:var(--surface2);color:var(--text);font-size:13px;font-family:inherit}
.add-task-row input:focus{outline:none;border-color:var(--gold)}
.add-task-row button{padding:10px 16px;border-radius:8px;border:none;background:var(--gold);color:#000;font-weight:700;font-size:13px;cursor:pointer}

/* HERO BANNER */
.hero-banner{position:relative;border-radius:14px;overflow:hidden;margin-bottom:20px;padding:56px 24px 44px;text-align:center;background:#0a0e18;border:1px solid rgba(255,179,0,0.1)}
.hero-banner .hero-img{position:absolute;inset:0;background-size:cover;background-position:center;opacity:0.35}
.hero-banner .hero-overlay{position:absolute;inset:0;background:linear-gradient(180deg,rgba(10,14,24,0.6) 0%,rgba(10,14,24,0.85) 100%)}
.hero-banner .hero-glow{position:absolute;top:10%;left:50%;transform:translateX(-50%);width:300px;height:300px;background:radial-gradient(circle,rgba(255,179,0,0.08),transparent 70%);pointer-events:none}
.hero-banner .hero-bat{position:absolute;top:16px;left:50%;transform:translateX(-50%);opacity:0.08}
.hero-banner .hero-quote{position:relative;font-size:19px;font-weight:700;line-height:1.6;color:#fff;max-width:560px;margin:0 auto 12px;font-style:italic;text-shadow:0 2px 20px rgba(0,0,0,0.5)}
.hero-banner .hero-source{position:relative;font-size:13px;color:var(--gold);font-weight:600;letter-spacing:0.5px;text-shadow:0 1px 10px rgba(0,0,0,0.4)}
body.light-mode .hero-banner{background:#d0d8ea}
body.light-mode .hero-banner .hero-img{opacity:0.2}
body.light-mode .hero-banner .hero-overlay{background:linear-gradient(180deg,rgba(220,228,240,0.5) 0%,rgba(208,216,234,0.8) 100%)}
body.light-mode .hero-banner .hero-quote{color:var(--text);text-shadow:none}
body.light-mode .hero-banner .hero-source{text-shadow:none}

/* SECTION HEROES */
.section-hero{position:relative;border-radius:12px;overflow:hidden;padding:32px 20px 24px;margin-bottom:20px;border:1px solid rgba(255,179,0,0.08)}
.section-hero .sh-img{position:absolute;inset:0;background-size:cover;background-position:center;opacity:0.25}
.section-hero .sh-overlay{position:absolute;inset:0}
.section-hero .sh-content{position:relative;display:flex;align-items:center;gap:14px}
.section-hero .sh-icon{font-size:32px;flex-shrink:0;filter:drop-shadow(0 2px 8px rgba(0,0,0,0.3))}
.section-hero .sh-text h2{font-size:20px;font-weight:800;margin-bottom:2px;text-shadow:0 1px 8px rgba(0,0,0,0.3)}
.section-hero .sh-text p{font-size:13px;color:var(--dim);margin:0}
.section-hero .sh-action{margin-left:auto;flex-shrink:0}
.sh-network{background:#12101f}.sh-network .sh-overlay{background:linear-gradient(135deg,rgba(18,16,31,0.7),rgba(26,21,48,0.85))}
.sh-learn{background:#0f1518}.sh-learn .sh-overlay{background:linear-gradient(135deg,rgba(15,21,24,0.7),rgba(16,26,32,0.85))}
.sh-social{background:#12101f}.sh-social .sh-overlay{background:linear-gradient(135deg,rgba(18,16,31,0.65),rgba(26,18,40,0.85))}
.sh-wins{background:#18140f}.sh-wins .sh-overlay{background:linear-gradient(135deg,rgba(24,20,15,0.6),rgba(31,26,16,0.8))}
.sh-alfred{background:#14110a}.sh-alfred .sh-overlay{background:linear-gradient(135deg,rgba(20,17,10,0.7),rgba(31,26,16,0.85))}
.sh-vault{background:#10101a}.sh-vault .sh-overlay{background:linear-gradient(135deg,rgba(16,16,26,0.7),rgba(26,20,40,0.85))}
.sh-timemachine{background:#0f1118}.sh-timemachine .sh-overlay{background:linear-gradient(135deg,rgba(15,17,24,0.65),rgba(20,26,40,0.82))}
body.light-mode .section-hero .sh-img{opacity:0.12}
body.light-mode .sh-network{background:#ede8f8}.sh-network .sh-overlay{background:linear-gradient(135deg,rgba(237,232,248,0.7),rgba(224,218,242,0.85))}
body.light-mode .sh-learn{background:#e6f2ea}.sh-learn .sh-overlay{background:linear-gradient(135deg,rgba(230,242,234,0.7),rgba(222,240,228,0.85))}
body.light-mode .sh-social{background:#f2e8ef}.sh-social .sh-overlay{background:linear-gradient(135deg,rgba(242,232,239,0.7),rgba(236,218,240,0.85))}
body.light-mode .sh-wins{background:#f4f0e8}.sh-wins .sh-overlay{background:linear-gradient(135deg,rgba(244,240,232,0.7),rgba(240,235,218,0.85))}
body.light-mode .sh-alfred{background:#f2efe8}.sh-alfred .sh-overlay{background:linear-gradient(135deg,rgba(242,239,232,0.7),rgba(237,232,218,0.85))}
body.light-mode .sh-vault{background:linear-gradient(135deg,#e8ecf4,#dae4f0)}
body.light-mode .sh-timemachine{background:linear-gradient(135deg,#e8ecf4,#dae4f0)}

/* CONFETTI */
@keyframes confettiFall{0%{transform:translateY(-10px) rotate(0deg);opacity:1}100%{transform:translateY(100vh) rotate(720deg);opacity:0}}
.confetti-piece{position:fixed;top:-10px;z-index:3000;animation:confettiFall 2.5s ease-in forwards;pointer-events:none}

/* MILESTONE PULSE */
@keyframes milestonePulse{0%,100%{box-shadow:0 0 15px rgba(255,179,0,0.08)}50%{box-shadow:0 0 30px rgba(255,179,0,0.2)}}
.milestone-pulse{animation:milestonePulse 2s ease-in-out infinite}

/* EMPTY STATE */
.empty{text-align:center;padding:40px;color:var(--dim);font-size:14px}

/* BIRTHDAY INPUT */
.bday-row{display:flex;gap:8px}
.bday-row select{flex:1}

/* FOLLOWER LOG */
.follower-log{display:flex;align-items:center;gap:12px;padding:12px 16px;border-radius:10px;background:var(--surface2);margin-bottom:12px}
.follower-count{font-size:28px;font-weight:800}
.follower-label{font-size:12px;color:var(--dim)}
.follower-input{width:100px;padding:6px 10px;border-radius:6px;border:1px solid var(--border);background:var(--surface);color:var(--text);font-size:14px;font-family:inherit;text-align:center}
.follower-input:focus{outline:none;border-color:var(--gold)}

/* FB GROUPS */
.group-item{display:flex;align-items:center;gap:12px;padding:10px 14px;border-radius:8px;background:var(--surface2);margin-bottom:6px}
.group-item a{flex:1;font-size:13px;font-weight:600}
.group-item button{padding:4px 8px;border-radius:4px;border:1px solid var(--border);background:none;color:var(--coral);font-size:11px;cursor:pointer}

/* STAR RATING */
.star-picker{display:flex;gap:4px}
.star-picker span{cursor:pointer;font-size:20px;color:var(--border);transition:color .2s}
.star-picker span.lit{color:var(--gold)}

/* RESPONSIVE */
@media(max-width:768px){
  /* Nav: horizontally scrollable */
  #topNav{padding:0 12px;height:50px}
  .nav-brand span{display:none}
  .nav-links{overflow-x:auto;-webkit-overflow-scrolling:touch;scrollbar-width:none;gap:2px;flex-shrink:1;min-width:0}
  .nav-links::-webkit-scrollbar{display:none}
  .nav-links a{padding:8px 12px;font-size:12px;white-space:nowrap;flex-shrink:0}
  .gear-btn{padding:6px;font-size:18px;flex-shrink:0}

  /* Main content */
  main{padding:62px 10px 16px;max-width:100%}
  .section-title{font-size:18px;gap:8px;flex-wrap:wrap}
  .section-title .btn{font-size:11px;padding:8px 12px}
  .card{padding:14px;margin-bottom:12px;border-radius:10px}
  .card h3{font-size:14px;flex-wrap:wrap}

  /* Briefing */
  .briefing{padding:16px;border-radius:10px}
  .briefing .msg{font-size:13px}

  /* Outreach counters: 3 columns still but tighter */
  .outreach-grid{grid-template-columns:repeat(3,1fr);gap:8px}
  .outreach-item{padding:12px 4px}
  .outreach-label{font-size:10px}
  .outreach-count{font-size:22px}
  .outreach-btns button{width:36px;height:36px;font-size:18px;border-radius:8px}

  /* Tasks: bigger tap targets */
  .task-item{padding:12px;gap:10px}
  .task-check{width:28px;height:28px;border-radius:8px}
  .task-check.checked::after{font-size:14px}
  .task-text{font-size:13px}
  .hq-btn{padding:6px 10px;font-size:11px}

  /* Add task input */
  .add-task-row{gap:6px}
  .add-task-row input{padding:12px;font-size:14px}
  .add-task-row button{padding:12px 14px;font-size:13px}

  /* Streak & goal */
  .streak-bar{padding:12px 16px;gap:10px}
  .streak-num{font-size:20px}
  .goal-bar{padding:12px 14px;gap:10px;flex-wrap:wrap}

  /* Network */
  .net-card{flex-direction:column;gap:10px;padding:14px}
  .net-actions{flex-wrap:wrap}
  .net-actions button{padding:8px 12px;font-size:12px}
  .net-filters{gap:6px}
  .net-filters button{padding:8px 12px;font-size:12px}
  .net-alert{font-size:12px;padding:10px 12px}
  .search-box{padding:12px;font-size:14px}

  /* Learn */
  .learn-card-container{min-height:240px}
  .learn-card{padding:24px 16px;border-radius:12px}
  .learn-card .card-title{font-size:17px}
  .learn-card .card-body{font-size:14px;margin-bottom:20px}
  .learn-card .save-btn{padding:10px 20px;font-size:14px}
  .learn-nav{gap:12px;margin-top:16px}
  .learn-nav button{padding:12px 20px;font-size:14px}
  .learn-tabs{gap:4px}
  .learn-tabs button{padding:6px 10px;font-size:11px}

  /* Social */
  .social-tabs{flex-direction:row;flex-wrap:wrap;gap:6px}
  .social-tabs button{flex:1 1 45%;min-width:0;padding:10px 8px;font-size:12px}
  .platform-launch{padding:12px 20px;font-size:14px}
  .checklist-item{padding:12px}
  .cl-check{width:24px;height:24px;border-radius:6px}
  .cl-check.checked::after{font-size:12px}
  .cl-text{font-size:13px}
  .follower-log{flex-wrap:wrap;gap:10px;padding:12px}
  .follower-count{font-size:24px}
  .group-item{padding:10px 12px}

  /* Alfred */
  .alfred-header{padding:16px}
  .alfred-avatar{width:60px;height:60px;font-size:28px}
  .chat-box{height:300px;padding:12px}
  .chat-msg{max-width:90%;padding:10px 12px;font-size:13px}
  .chat-input-row{padding:10px}
  .chat-input-row input{padding:10px 12px;font-size:14px}
  .chat-input-row button{padding:10px 16px}
  .quick-prompts button{padding:8px 12px;font-size:12px}

  /* Vault */
  .vault-entry{padding:12px}
  .vault-entry .ve-title{font-size:14px}
  .vault-entry .ve-preview{font-size:12px}

  /* Time Machine */
  .tm-countdown{padding:20px 16px}
  .tm-days{font-size:48px}
  .tm-milestones{grid-template-columns:repeat(3,1fr);gap:6px}
  .tm-mile{padding:10px 6px}

  /* Wins */
  .win-item{padding:12px}
  .win-totals{gap:6px}
  .win-totals .wt{padding:6px 10px;font-size:12px}

  /* Hero & section heroes */
  .hero-banner{padding:32px 16px 24px}
  .hero-banner .hero-quote{font-size:15px;max-width:100%}
  .hero-banner .hero-source{font-size:12px}
  .hero-banner .hero-bat{display:none}
  .section-hero{padding:20px 14px 16px}
  .section-hero .sh-content{gap:10px;flex-wrap:wrap}
  .section-hero .sh-icon{font-size:26px}
  .section-hero .sh-text h2{font-size:17px}
  .section-hero .sh-text p{font-size:12px}
  .section-hero .sh-action{margin-left:0}

  /* Modals */
  .modal-box{width:95%;max-width:none;padding:20px;border-radius:12px;max-height:90vh}
  .modal-box h2{font-size:16px;margin-bottom:16px}
  .form-group{margin-bottom:12px}
  .form-group label{font-size:11px;margin-bottom:4px}
  .form-group input,.form-group select,.form-group textarea{padding:12px;font-size:14px}
  .form-row{flex-direction:column;gap:0}
  .btn-row{gap:6px}
  .btn{padding:12px 16px;font-size:14px}
  .star-picker span{font-size:28px}
  .bday-row select{padding:12px;font-size:14px}
}

/* Small phones */
@media(max-width:380px){
  .outreach-grid{grid-template-columns:1fr}
  .nav-links a{padding:6px 8px;font-size:11px}
  .social-tabs button{flex:1 1 100%}
  .tm-milestones{grid-template-columns:repeat(2,1fr)}
}
</style>
</head>
<body>

<nav id="topNav">
  <div class="nav-brand">
    <svg viewBox="0 0 40 24" width="28" height="18" fill="var(--gold)"><path d="M20 2C17 8,8 6,2 12C8 10,14 14,20 22C26 14,32 10,38 12C32 6,23 8,20 2Z"/></svg>
    <span>The Bat Cave</span>
  </div>
  <div class="nav-links">
    <a onclick="switchView('today')" id="nav-today" class="active">Mission Control</a>
    <a onclick="switchView('alfred')" id="nav-alfred">Alfred</a>
    <a onclick="switchView('network')" id="nav-network">Network</a>
    <a onclick="switchView('learn')" id="nav-learn">Learn</a>
    <a onclick="switchView('social')" id="nav-social">Social</a>
    <a onclick="switchView('vault')" id="nav-vault">Vault</a>
    <a onclick="switchView('timemachine')" id="nav-timemachine">Time Machine</a>
    <a onclick="switchView('wins')" id="nav-wins">Wins</a>
  </div>
  <div style="display:flex;gap:2px"><button class="gear-btn" id="theme-toggle" onclick="toggleTheme()" title="Toggle light/dark mode">&#9790;</button><button class="gear-btn" onclick="openModal('settingsModal')">&#9881;</button></div>
</nav>

<main>
  <div id="view-today" class="view active"></div>
  <div id="view-alfred" class="view"></div>
  <div id="view-network" class="view"></div>
  <div id="view-learn" class="view"></div>
  <div id="view-social" class="view"></div>
  <div id="view-vault" class="view"></div>
  <div id="view-timemachine" class="view"></div>
  <div id="view-wins" class="view"></div>
</main>

<!-- Settings Modal -->
<div class="modal-overlay" id="settingsModal" onclick="if(event.target===this)closeModal('settingsModal')">
<div class="modal-box">
  <h2>Settings</h2>
  <div class="form-group"><label>LinkedIn Profile URL</label><input id="set-linkedin" placeholder="https://linkedin.com/in/yourname"></div>
  <div class="form-group"><label>Instagram Profile URL</label><input id="set-instagram" placeholder="https://instagram.com/yourhandle"></div>
  <div class="form-group"><label>Facebook Profile/Page URL</label><input id="set-facebook" placeholder="https://facebook.com/yourpage"></div>
  <div class="form-row">
    <div class="form-group"><label>Email Target</label><input type="number" id="set-emails" value="50"></div>
    <div class="form-group"><label>Call Target</label><input type="number" id="set-calls" value="20"></div>
    <div class="form-group"><label>DM Target</label><input type="number" id="set-dms" value="15"></div>
  </div>
  <div style="border-top:1px solid var(--border);margin:16px 0;padding-top:16px">
    <div style="font-size:14px;font-weight:800;margin-bottom:10px;color:var(--gold)">Data Backup</div>
    <div style="display:flex;gap:10px">
      <button class="btn btn-outline" onclick="exportData()" style="flex:1">&#11123; Export Backup</button>
      <button class="btn btn-outline" onclick="document.getElementById('importFile').click()" style="flex:1">&#11121; Import Backup</button>
      <input type="file" id="importFile" accept=".json" style="display:none" onchange="importData(event)">
    </div>
    <div style="font-size:11px;color:var(--dim);margin-top:6px">Export regularly to protect your data.</div>
  </div>
  <div class="btn-row"><button class="btn btn-gold" onclick="saveSettings()">Save Settings</button></div>
</div>
</div>

<!-- Network Contact Modal -->
<div class="modal-overlay" id="networkModal" onclick="if(event.target===this)closeModal('networkModal')">
<div class="modal-box">
  <h2 id="net-modal-title">Add Contact</h2>
  <input type="hidden" id="net-edit-id">
  <div class="form-row">
    <div class="form-group"><label>Name</label><input id="net-name" placeholder="John Smith"></div>
    <div class="form-group"><label>Company</label><input id="net-company" placeholder="BigLawn Inc"></div>
  </div>
  <div class="form-row">
    <div class="form-group"><label>Role</label><input id="net-role" placeholder="CEO, Owner, etc."></div>
    <div class="form-group"><label>Category</label>
      <select id="net-category"><option value="Mentor">Mentor</option><option value="Peer">Peer</option><option value="Partner">Partner</option><option value="Industry">Industry Connection</option><option value="Referral">Referral Source</option><option value="Other">Other</option></select>
    </div>
  </div>
  <div class="form-group"><label>How You Met</label><input id="net-howmet" placeholder="LinkedIn, conference, referral..."></div>
  <div class="form-row">
    <div class="form-group"><label>LinkedIn URL</label><input id="net-linkedin" placeholder="https://linkedin.com/in/..."></div>
    <div class="form-group"><label>Phone</label><input id="net-phone" placeholder="(555) 123-4567"></div>
  </div>
  <div class="form-group"><label>Email</label><input id="net-email" placeholder="john@example.com"></div>
  <div class="form-group"><label>Birthday</label>
    <div class="bday-row">
      <select id="net-bday-month"><option value="">Month</option><option value="1">January</option><option value="2">February</option><option value="3">March</option><option value="4">April</option><option value="5">May</option><option value="6">June</option><option value="7">July</option><option value="8">August</option><option value="9">September</option><option value="10">October</option><option value="11">November</option><option value="12">December</option></select>
      <select id="net-bday-day"><option value="">Day</option></select>
    </div>
  </div>
  <div class="form-group"><label>Relationship Strength</label><div class="star-picker" id="net-stars"></div></div>
  <div class="form-group"><label>Notes</label><textarea id="net-notes" rows="3" placeholder="Key things to remember..."></textarea></div>
  <div class="btn-row">
    <button class="btn btn-danger" id="net-delete-btn" style="display:none;margin-right:auto" onclick="deleteNetContact()">Delete</button>
    <button class="btn btn-outline" onclick="closeModal('networkModal')">Cancel</button>
    <button class="btn btn-gold" onclick="saveNetContact()">Save</button>
  </div>
</div>
</div>

<!-- Touch Log Modal -->
<div class="modal-overlay" id="touchModal" onclick="if(event.target===this)closeModal('touchModal')">
<div class="modal-box">
  <h2>Log Interaction</h2>
  <input type="hidden" id="touch-contact-id">
  <div class="form-group"><label>Type</label>
    <select id="touch-type"><option value="Call">Call</option><option value="Coffee">Coffee / Meeting</option><option value="DM">DM / Message</option><option value="Email">Email</option><option value="Event">Event / Conference</option><option value="Other">Other</option></select>
  </div>
  <div class="form-group"><label>Date</label><input type="date" id="touch-date"></div>
  <div class="form-group"><label>Notes</label><textarea id="touch-notes" rows="3" placeholder="What did you talk about?"></textarea></div>
  <div class="btn-row"><button class="btn btn-outline" onclick="closeModal('touchModal')">Cancel</button><button class="btn btn-gold" onclick="saveTouch()">Log It</button></div>
</div>
</div>

<!-- Add Learn Card Modal -->
<div class="modal-overlay" id="learnModal" onclick="if(event.target===this)closeModal('learnModal')">
<div class="modal-box">
  <h2>Add Your Own Card</h2>
  <div class="form-group"><label>Title</label><input id="learn-title" placeholder="Key insight..."></div>
  <div class="form-group"><label>Category</label>
    <select id="learn-category"><option value="Sales">Sales</option><option value="Network">Networking</option><option value="Growth">Business Growth</option><option value="Comms">Communication</option><option value="Leadership">Leadership</option><option value="Industry">Industry</option><option value="Social">Social Media</option><option value="Mindset">Mindset</option></select>
  </div>
  <div class="form-group"><label>Insight</label><textarea id="learn-body" rows="4" placeholder="What did you learn?"></textarea></div>
  <div class="btn-row"><button class="btn btn-outline" onclick="closeModal('learnModal')">Cancel</button><button class="btn btn-gold" onclick="saveLearnCard()">Add Card</button></div>
</div>
</div>

<!-- Add Win Modal -->
<div class="modal-overlay" id="winModal" onclick="if(event.target===this)closeModal('winModal')">
<div class="modal-box">
  <h2>Log a Win</h2>
  <div class="form-group"><label>What happened?</label><textarea id="win-desc" rows="3" placeholder="I closed a deal, made a great connection, learned something new..."></textarea></div>
  <div class="form-group"><label>Category</label>
    <select id="win-category"><option value="Sale">Sale</option><option value="Network">Network</option><option value="Learning">Learning</option><option value="Social">Social Media</option><option value="Personal">Personal</option></select>
  </div>
  <div class="btn-row"><button class="btn btn-outline" onclick="closeModal('winModal')">Cancel</button><button class="btn btn-gold" onclick="saveWin()">Log Win</button></div>
</div>
</div>

<!-- Add FB Group Modal -->
<div class="modal-overlay" id="groupModal" onclick="if(event.target===this)closeModal('groupModal')">
<div class="modal-box">
  <h2>Add Facebook Group</h2>
  <div class="form-group"><label>Group Name</label><input id="group-name" placeholder="Lawn Care Entrepreneurs"></div>
  <div class="form-group"><label>Group URL</label><input id="group-url" placeholder="https://facebook.com/groups/..."></div>
  <div class="btn-row"><button class="btn btn-outline" onclick="closeModal('groupModal')">Cancel</button><button class="btn btn-gold" onclick="saveFBGroup()">Add Group</button></div>
</div>
</div>

<!-- Vault Entry Modal -->
<div class="modal-overlay" id="vaultModal" onclick="if(event.target===this)closeModal('vaultModal')">
<div class="modal-box">
  <h2 id="vault-modal-title">Add to Vault</h2>
  <input type="hidden" id="vault-edit-id">
  <div class="form-group"><label>Title</label><input id="vault-title" placeholder="e.g. 'I already talk to my guys' objection"></div>
  <div class="form-group"><label>Tags</label>
    <div style="display:flex;gap:6px;flex-wrap:wrap" id="vault-tag-picker"></div>
  </div>
  <div class="form-group"><label>Content</label><textarea id="vault-content" rows="6" placeholder="The insight, script, objection response, or idea..."></textarea></div>
  <div class="form-group"><label>Source (optional)</label><input id="vault-source" placeholder="Book, podcast, call, experience..."></div>
  <div class="btn-row">
    <button class="btn btn-danger" id="vault-delete-btn" style="display:none;margin-right:auto" onclick="deleteVaultEntry()">Delete</button>
    <button class="btn btn-outline" onclick="closeModal('vaultModal')">Cancel</button>
    <button class="btn btn-gold" onclick="saveVaultEntry()">Save</button>
  </div>
</div>
</div>

<!-- Time Machine Settings Modal -->
<div class="modal-overlay" id="tmModal" onclick="if(event.target===this)closeModal('tmModal')">
<div class="modal-box">
  <h2>Time Machine Settings</h2>
  <div class="form-group"><label>Target Date</label><input type="date" id="tm-target-date" value="2026-08-01"></div>
  <div class="form-group"><label>Target Clients</label><input type="number" id="tm-target-clients" value="50"></div>
  <div class="form-group"><label>Target MRR ($)</label><input type="number" id="tm-target-mrr" value="17500"></div>
  <div class="btn-row"><button class="btn btn-outline" onclick="closeModal('tmModal')">Cancel</button><button class="btn btn-gold" onclick="saveTMSettings()">Save</button></div>
</div>
</div>

<script>
/* ========== CONSTANTS & UTILS ========== */
const STORAGE_KEY='batCave';
const HQ_KEY='crewVoiceHQ';
const MONTHS=['January','February','March','April','May','June','July','August','September','October','November','December'];
function uid(){return Date.now().toString(36)+Math.random().toString(36).slice(2,7)}
function esc(s){if(!s)return'';const d=document.createElement('div');d.textContent=s;return d.innerHTML}
function todayStr(){return new Date().toISOString().slice(0,10)}
function daysBetween(a,b){return Math.floor((new Date(b)-new Date(a))/(86400000))}
function fmtDate(d){if(!d)return'';const p=d.split('-');return MONTHS[+p[1]-1]+' '+parseInt(p[2])+', '+p[0]}

/* ========== DATA ========== */
function defaultData(){return{
  manualTasks:[],dailyStats:{},streak:0,network:[],
  learnCards:seedCards(),savedCardIds:[],learnIndex:0,learnFilter:'All',
  socialChecklist:{},customSocialItems:[],socialTab:'ig',
  igFollowers:[],fbGroups:[],liFollowers:[],
  wins:[],gameplans:{},
  vault:[],
  timeMachine:{targetDate:'2026-08-01',targetClients:50,targetMRR:17500},
  settings:{linkedin:'',instagram:'',facebook:'',emailTarget:50,callTarget:20,dmTarget:15}
}}
let data;
function loadData(){
  const raw=localStorage.getItem(STORAGE_KEY);
  if(!raw)return defaultData();
  try{
    const d=JSON.parse(raw);const def=defaultData();
    Object.keys(def).forEach(function(k){
      if(d[k]===undefined||d[k]===null)d[k]=def[k];
      else if(Array.isArray(def[k])&&!Array.isArray(d[k]))d[k]=def[k];
      else if(typeof def[k]==='object'&&!Array.isArray(def[k])&&(typeof d[k]!=='object'||Array.isArray(d[k])))d[k]=def[k];
    });
    if(d.settings){const ds=def.settings;Object.keys(ds).forEach(function(k){if(d.settings[k]===undefined)d.settings[k]=ds[k]})}
    if(!d.learnCards||d.learnCards.length===0)d.learnCards=seedCards();
    return d;
  }catch(e){return defaultData()}
}
function saveData(d){localStorage.setItem(STORAGE_KEY,JSON.stringify(d))}
function save(){saveData(data)}

function exportData(){
  var blob=new Blob([JSON.stringify(data,null,2)],{type:'application/json'});
  var a=document.createElement('a');
  a.href=URL.createObjectURL(blob);
  a.download='batcave-backup-'+new Date().toISOString().slice(0,10)+'.json';
  a.click();URL.revokeObjectURL(a.href);
}
function importData(e){
  var file=e.target.files[0];if(!file)return;
  var reader=new FileReader();
  reader.onload=function(ev){
    try{
      var imported=JSON.parse(ev.target.result);
      if(!imported||typeof imported!=='object'){alert('Invalid backup file.');return}
      if(!confirm('This will REPLACE all current data with the backup. Are you sure?'))return;
      data=imported;save();location.reload();
    }catch(err){alert('Error reading backup file: '+err.message)}
  };
  reader.readAsText(file);
  e.target.value='';
}

/* ========== HQ READER ========== */
function readHQ(){
  try{const r=localStorage.getItem(HQ_KEY);if(!r)return null;return JSON.parse(r)}catch(e){return null}
}

/* ========== SEEDED LEARN CARDS ========== */
function seedCards(){return[
{id:'s1',t:'Lead With Their Pain',c:'Sales',d:"The best cold email isn't about you — it's about their problem. 'Are you losing crew members you didn't see coming?' beats 'We offer interview services' every time."},
{id:'s2',t:'Follow Up or Fall Behind',c:'Sales',d:"80% of sales need 5+ follow-ups, but 44% of people quit after one. Every time you don't follow up, you hand money to the competitor who will."},
{id:'s3',t:'The Specificity Principle',c:'Sales',d:"Mention something specific about their business in every cold email. 'I noticed your team serves the Eastside with 12 crew' shows you did homework. Generic gets deleted."},
{id:'s4',t:'Sell the Outcome',c:'Sales',d:"Nobody wants 'monthly employee interviews.' They want to know before their best foreman quits. Sell the outcome: peace of mind, zero surprise resignations."},
{id:'s5',t:'The 3-Second Rule',c:'Sales',d:"Your subject line gets 3 seconds. If it doesn't spark curiosity or hit a pain point, it's dead. 'Quick question about your crew' beats 'Introducing Our Services.'"},
{id:'s6',t:'Objection = Interest',c:'Sales',d:"When a prospect pushes back, they're engaged. 'I already talk to my guys' means they care about retention. That's your opening — reframe their objection into your value."},
{id:'s7',t:'Call After Email 3',c:'Sales',d:"The phone call between email 3 and 4 is where deals close. They've seen your name 3 times. Now make it personal. Voice builds trust faster than text."},
{id:'s8',t:'The Referral Ask',c:'Sales',d:"After every successful month with a client, ask: 'Know any other owners who struggle with crew retention?' Referrals close 4x faster than cold leads."},
{id:'s9',t:'Price Anchoring',c:'Sales',d:"$299/month sounds expensive until you compare it to $8,000 to replace one crew member. Always anchor your price against the cost of the problem, not other services."},
{id:'s10',t:'The Guarantee Close',c:'Sales',d:"When someone's on the fence: 'If the first report doesn't surface anything useful, you don't pay.' Zero risk removes the last barrier. Use it confidently."},
{id:'s11',t:'Timing Is Everything',c:'Sales',d:"Best times to reach landscaping owners: 6-7 AM before crews go out, 12-1 PM at lunch, or after 5 PM wrapping up. Never mid-morning during peak operations."},
{id:'s12',t:'The Voicemail Formula',c:'Sales',d:"30 seconds max: Name, company, one pain point, your number. 'Hey Mike, it's Luke from Crew Voice. I help landscaping owners find out what's frustrating their crew before they quit.'"},
{id:'s13',t:'Track Everything',c:'Sales',d:"If you can't measure it, you can't improve it. Track emails sent, open rates, reply rates, calls made, meetings booked, deals closed. Data drives decisions."},
{id:'s14',t:'Kill the Word \"Just\"',c:'Sales',d:"Remove 'just' from your vocabulary. 'Just checking in' = weak. 'Following up because crew season starts in March and I want you covered' = strong and urgent."},
{id:'s15',t:'Speed to Lead',c:'Sales',d:"Respond to every inbound inquiry within 5 minutes. After 30 minutes, your chances of connecting drop 100x. Speed wins deals. Set up mobile notifications."},
{id:'s16',t:'Give First, Always',c:'Network',d:"The most powerful networkers lead with value. Share an article, make an intro, offer advice. Build the relationship before you ever need something from it."},
{id:'s17',t:'The 24-Hour Rule',c:'Network',d:"Follow up within 24 hours of meeting someone new. Send a LinkedIn connection with a personal note. After 48 hours, you're just another forgotten handshake."},
{id:'s18',t:'Your Network = Net Worth',c:'Network',d:"You're the average of the 5 people you spend the most time with. Deliberately choose those 5. Surround yourself with people who are where you want to be."},
{id:'s19',t:'The Coffee Meeting Formula',c:'Network',d:"Every coffee meeting needs: 1) A genuine question about their journey, 2) One way you can help them, 3) A single ask for one introduction. Keep it simple."},
{id:'s20',t:'LinkedIn Is a Goldmine',c:'Network',d:"Comment thoughtfully on 5 posts per day from people in your industry. Not 'Great post!' — real comments with substance. In 90 days, your network doubles."},
{id:'s21',t:'Be Memorable',c:'Network',d:"After meeting someone, send them something relevant within a week. An industry article, a book recommendation, a useful connection. This is how you stand out from everyone else."},
{id:'s22',t:'The Monthly Check-In',c:'Network',d:"Set a recurring reminder to reach out to your top 20 contacts every month. Not to sell — just to connect. 'Hey, saw this and thought of you' goes a long way."},
{id:'s23',t:'Ask for Advice, Not Favors',c:'Network',d:"People love giving advice. Instead of 'Can you introduce me to X,' try 'I'm building a service for landscaping companies — what would you do differently?'"},
{id:'s24',t:'Join the Room',c:'Network',d:"Find the Facebook groups, LinkedIn communities, and local meetups where your ideal clients hang out. Be helpful for 30 days before you pitch anything."},
{id:'s25',t:'Strategic Introductions',c:'Network',d:"Every time you connect two people who can help each other, you become more valuable to both. Be the connector. Introductions compound faster than anything."},
{id:'s26',t:'Revenue Solves Everything',c:'Growth',d:"Before you perfect your pitch deck or build fancy systems — sell something. Revenue is oxygen. Get cash flowing first, then refine everything else around it."},
{id:'s27',t:'The 50-Client Math',c:'Growth',d:"50 clients at $299/mo = $14,950+ MRR. Work backward: you might need 500 conversations. That's 10/day for 50 days. Every conversation compounds toward the goal."},
{id:'s28',t:'Niche Down to Scale Up',c:'Growth',d:"Being 'the lawn care crew retention company' is 10x more powerful than 'an employee engagement platform.' Own a niche completely before you try to expand."},
{id:'s29',t:'One Channel at a Time',c:'Growth',d:"Don't try LinkedIn, Facebook, email, calls, and Instagram all at once. Master one channel, systematize it, then add the next. Depth beats width every time."},
{id:'s30',t:'The First 10 Are the Hardest',c:'Growth',d:"After 10 clients, you have testimonials, case studies, referrals, and confidence. The first 10 are a pure grind. Push through — it gets exponentially easier."},
{id:'s31',t:'Systemize or Drown',c:'Growth',d:"Every repeatable task needs a system. Email sequences. Follow-up cadences. Onboarding checklists. If you do something more than twice, build a system for it."},
{id:'s32',t:'Results Are Your Best Marketing',c:'Growth',d:"One client success story is worth 100 social media posts. Deliver exceptional results for current clients and the referrals will follow naturally."},
{id:'s33',t:'Cash Flow Is King',c:'Growth',d:"Month-to-month billing = predictable but fragile cash flow. Focus on reducing churn as much as acquiring. A client who stays 12 months is worth 12x a one-month trial."},
{id:'s34',t:'Think in 90-Day Sprints',c:'Growth',d:"Set one big goal per quarter. Q1: Get to 10 clients. Q2: Get to 25. Q3: Get to 50. Break it down monthly, weekly, daily. Small bites eat the elephant."},
{id:'s35',t:'Competition Is Validation',c:'Growth',d:"If someone else offers something similar, that means there's a market. Don't fear competition — learn from them, differentiate, and outwork them."},
{id:'s36',t:'Listen 70/30',c:'Comms',d:"In a sales call, they should talk 70%, you 30%. The more they talk, the more they sell themselves. Ask questions, then shut up and listen."},
{id:'s37',t:'Use Their Words',c:'Comms',d:"When a prospect says 'I'm worried about losing my best guy,' don't say 'We help with retention.' Say 'We make sure you never lose your best guy without warning.'"},
{id:'s38',t:'Stories Beat Stats',c:'Comms',d:"Don't just say turnover costs $8,000. Tell the story: 'It's Friday afternoon. Your lead foreman walks up and says next week's his last...' Make them feel it."},
{id:'s39',t:'The Power of Silence',c:'Comms',d:"After you state your price or make an ask, stop talking. Silence is uncomfortable, but the first person to break it loses leverage. Let them process."},
{id:'s40',t:'Ask, Don\'t Tell',c:'Comms',d:"Instead of 'You should try Crew Voice,' ask 'What would it be worth to know exactly how your crew feels about working here?' Questions pull people in."},
{id:'s41',t:'Confidence Is Contagious',c:'Comms',d:"If you don't believe your service is worth $299/month, nobody will. You're saving them $8,000+ per prevented resignation. Own your value. Mean it."},
{id:'s42',t:'The Bridge Phrase',c:'Comms',d:"When handling objections, use: 'I totally understand that, and here's what I've found...' It validates their concern without agreeing with their conclusion."},
{id:'s43',t:'End With a Question',c:'Comms',d:"Every email should end with a specific question. 'Would Tuesday at 10am work for a quick call?' beats 'Let me know if you're interested.' Questions demand responses."},
{id:'s44',t:'Hire Slow, Fire Fast',c:'Leadership',d:"Take your time finding the right people. But when someone isn't working out, every day you delay costs time, money, and team morale. Be decisive."},
{id:'s45',t:'Document Everything',c:'Leadership',d:"SOPs, processes, templates — if it's only in your head, it's a bottleneck. Write it down so anyone can execute it. This is how you scale past yourself."},
{id:'s46',t:'Delegate the What, Not How',c:'Leadership',d:"Tell people what success looks like and let them figure out how to get there. Micromanagement kills motivation and limits your team's growth."},
{id:'s47',t:'Weekly Metrics Review',c:'Leadership',d:"Every Friday: leads added, emails sent, calls made, meetings booked, deals closed, revenue. Know your numbers cold. Data drives decisions, not feelings."},
{id:'s48',t:'Protect Your Peak Hours',c:'Leadership',d:"Your energy is your biggest asset. Use your sharpest hours for revenue-generating activities — selling, outreach, networking. Save admin for low-energy times."},
{id:'s49',t:'Seasonality Is Real',c:'Industry',d:"Lawn care owners think about hiring in Feb/March and retention in May/June. Time your outreach to match their cycle. Right now, they're planning for the season ahead."},
{id:'s50',t:'The Language Gap',c:'Industry',d:"60%+ of lawn care crews speak Spanish first. If the owner doesn't speak Spanish, they have a massive blind spot on morale and retention. This is YOUR wedge."},
{id:'s51',t:'The Crew Size Sweet Spot',c:'Industry',d:"Companies with 5-25 crew members are ideal. Under 5, they don't need the service. Over 25, they might have HR. The sweet spot is 8-15 — big enough to need you, small enough to not have HR."},
{id:'s52',t:'The Friday Resignation',c:'Industry',d:"Most crew members who quit do it on a Friday. By the time the owner knows, they've got a full weekend to panic. Monthly check-ins catch problems weeks before they become resignations."},
{id:'s53',t:'Consistency Beats Virality',c:'Social',d:"Posting 3x/week for 6 months builds more business than one viral post. Show up every day. The algorithm rewards consistency over genius. Just keep posting."},
{id:'s54',t:'Comment Strategy',c:'Social',d:"For every post you make, comment on 5 others. Real comments with substance, not 'Great post!' This is how you get noticed without spending a dollar on ads."},
{id:'s55',t:'Facebook Groups Are Gold',c:'Social',d:"Lawn care owner groups are where your clients live. Be helpful for 30 days before you mention your business. Earn the right to pitch by adding value first."},
{id:'s56',t:'LinkedIn DM Formula',c:'Social',d:"Connect first. Like/comment on 2-3 of their posts. Then send a value-first DM. Never pitch in the connection request. Build familiarity before you sell."},
{id:'s57',t:'Content That Converts',c:'Social',d:"Educational content builds trust. 'How to reduce crew turnover in 3 steps' positions you as the expert. The sale comes naturally after you've taught them something."},
{id:'s58',t:'Action Cures Fear',c:'Mindset',d:"Afraid to make that call? Make 5 more. Afraid to post on LinkedIn? Post twice. The only way past fear is through it. Action builds confidence, not the other way around."},
{id:'s59',t:'Play the Long Game',c:'Mindset',d:"You won't get 50 clients this month. But every email, call, and connection is compounding. In 6 months, you'll look back and be amazed how far you've come. Trust the process."},
{id:'s60',t:'Comparison Is Poison',c:'Mindset',d:"Don't compare your Day 30 to someone else's Year 3. You're building something real, from scratch. Focus on your own trajectory and let results compound."},
{id:'s61',t:'The 1% Rule',c:'Mindset',d:"Get 1% better every day at sales, networking, or your craft. In one year, that's 37x improvement. Small daily improvements create massive results over time."},
{id:'s62',t:'Embrace Rejection',c:'Mindset',d:"Every 'no' is data. Every 'not right now' is a future 'yes.' Every ignored email is one step closer to the person who'll say 'tell me more.' Keep going."},
{id:'s63',t:'Rest Is Productive',c:'Mindset',d:"Grinding 18 hours a day doesn't make you a better entrepreneur — it makes you a tired one. Protect your sleep, health, and relationships. They fuel everything."},
{id:'s64',t:'Your Why Matters',c:'Mindset',d:"On the hard days, your 'why' keeps you going. You're not just building a business — you're helping real people keep their teams together and their livelihoods stable."},
{id:'s65',t:'Reels That Hook',c:'Social',d:"First 1.5 seconds determine if someone watches your reel. Start with a bold statement or question: 'The most expensive employee isn't the one you pay the most.' Hook them immediately."}
]}

/* ========== CONTENT IDEAS ========== */
const CONTENT_IDEAS=[
{t:'The Hook',d:'"Your crew is talking. Just not to you."',p:'LI, FB'},
{t:'The Math',d:'"$8,000 to replace one crew member..."',p:'LI, FB'},
{t:'The Language Barrier',d:'"When did you last ask your Spanish-speaking crew how they really feel?"',p:'FB Groups'},
{t:'The Warning Signs',d:'"7 signs your best crew member is about to quit"',p:'LI'},
{t:'The Real Cost',d:'"Can\'t afford $299/month? Can you afford $8K for a replacement?"',p:'FB, LI'},
{t:'Short-Form Hook',d:'"The most expensive employee isn\'t the one you pay the most."',p:'Reels'},
{t:'Owner Pain Point',d:'"Your best guy says Friday is his last week. Sound familiar?"',p:'FB Groups'},
{t:'The Spouse Test',d:'"Your crew member\'s wife knows more about his job satisfaction than you do."',p:'LI'},
{t:'Social Proof',d:'"Something I hear from every owner: I had NO IDEA that was an issue."',p:'LI, FB'},
{t:'Objection Handling',d:'"My guys won\'t talk to a stranger. Here\'s what actually happens..."',p:'FB'},
{t:'Quick Tip',d:'"The #1 reason crew members leave isn\'t money. It\'s feeling invisible."',p:'LI'},
{t:'Behind the Scenes',d:'"What a Crew Voice report actually looks like..."',p:'LI, Reels'},
{t:'Industry Stat',d:'"30%+ turnover rate. Do you know which 3 of your 10 won\'t be here next year?"',p:'FB, LI'},
{t:'Bilingual Advantage',d:'"If 60% of your crew speaks Spanish and you don\'t — you have a blind spot."',p:'FB Groups'},
{t:'Direct CTA',d:'"If you run a lawn care company with 5+ crew, here\'s what I\'ll do for you..."',p:'LI, FB'}
];

/* ========== MOTIVATIONAL QUOTES ========== */
const HERO_QUOTES=[
  {q:'It\'s not who I am underneath, but what I do that defines me.',s:'Batman'},
  {q:'Why do we fall? So we can learn to pick ourselves up.',s:'Batman Begins'},
  {q:'The night is darkest just before the dawn. And I promise you, the dawn is coming.',s:'The Dark Knight'},
  {q:'A hero can be anyone. Even a man doing something as simple as putting a coat around a young boy\'s shoulders.',s:'Batman'},
  {q:'Everything\'s impossible until somebody does it.',s:'Bruce Wayne'},
  {q:'I can do all things through Christ who strengthens me.',s:'Philippians 4:13'},
  {q:'For I know the plans I have for you, declares the Lord. Plans to prosper you and not to harm you. Plans to give you hope and a future.',s:'Jeremiah 29:11'},
  {q:'Be strong and courageous. Do not be afraid; do not be discouraged, for the Lord your God will be with you wherever you go.',s:'Joshua 1:9'},
  {q:'Commit to the Lord whatever you do, and He will establish your plans.',s:'Proverbs 16:3'},
  {q:'The Lord is my shepherd; I shall not want.',s:'Psalm 23:1'},
  {q:'Trust in the Lord with all your heart and lean not on your own understanding.',s:'Proverbs 3:5'},
  {q:'But those who hope in the Lord will renew their strength. They will soar on wings like eagles.',s:'Isaiah 40:31'},
  {q:'Have I not commanded you? Be strong and courageous. Do not be afraid.',s:'Joshua 1:9'},
  {q:'No weapon formed against you shall prosper.',s:'Isaiah 54:17'},
  {q:'It ain\'t about how hard you hit. It\'s about how hard you can get hit and keep moving forward.',s:'Rocky Balboa'},
  {q:'Every champion was once a contender who refused to give up.',s:'Rocky'},
  {q:'Going in one more round when you don\'t think you can. That\'s what makes all the difference in your life.',s:'Rocky'},
  {q:'The world ain\'t all sunshine and rainbows. It\'s a very mean and nasty place. But it ain\'t about how hard you hit.',s:'Rocky Balboa'},
  {q:'The mountain doesn\'t care about your excuses. Neither does success.',s:'The Summit'},
  {q:'Discipline is choosing between what you want now and what you want most.',s:'Abraham Lincoln'},
  {q:'The pain you feel today will be the strength you feel tomorrow.',s:'The Climb'},
  {q:'Ships are safe in harbor, but that\'s not what ships are built for.',s:'John A. Shedd'},
  {q:'A smooth sea never made a skilled sailor.',s:'Franklin D. Roosevelt'},
  {q:'The only impossible journey is the one you never begin.',s:'Tony Robbins'},
  {q:'The harder the battle, the sweeter the victory.',s:'Les Brown'},
  {q:'I am the storm.',s:'The Warrior\'s Creed'},
  {q:'What we do in life echoes in eternity.',s:'Gladiator'},
  {q:'Arise, for this matter is your responsibility. We also are with you. Be of good courage, and do it.',s:'Ezra 10:4'},
  {q:'The plans of the diligent lead to profit as surely as haste leads to poverty.',s:'Proverbs 21:5'},
  {q:'Whatever you do, work at it with all your heart, as working for the Lord.',s:'Colossians 3:23'}
];
function getDailyQuote(){
  const dayNum=Math.floor(daysBetween('2025-01-01',todayStr()));
  return HERO_QUOTES[((dayNum%HERO_QUOTES.length)+HERO_QUOTES.length)%HERO_QUOTES.length];
}

/* ========== SVG TEMPLATES ========== */
function svgMountains(color){
  return '<svg viewBox="0 0 900 120" fill="'+(color||'currentColor')+'" preserveAspectRatio="none"><path d="M0,120 L0,80 L80,45 L150,75 L220,30 L300,60 L370,20 L440,55 L520,10 L600,50 L670,25 L740,58 L810,35 L900,65 L900,120Z"/></svg>';
}
function svgBat(size){
  return '<svg viewBox="0 0 120 60" width="'+(size||120)+'" fill="currentColor"><path d="M60 5C55 18,30 14,8 28C22 24,38 34,52 52L60 60L68 52C82 34,98 24,112 28C90 14,65 18,60 5Z"/></svg>';
}
function svgCross(size){
  return '<svg viewBox="0 0 40 60" width="'+(size||30)+'" fill="currentColor" opacity="0.07"><rect x="15" y="0" width="10" height="60" rx="2"/><rect x="2" y="12" width="36" height="10" rx="2"/></svg>';
}

/* ========== CONFETTI ========== */
function launchConfetti(){
  const colors=['#FFB300','#FF8F00','#00E676','#40C4FF','#B388FF','#F06292','#FF6B6B'];
  for(let i=0;i<40;i++){
    const el=document.createElement('div');
    el.className='confetti-piece';
    const size=Math.random()*8+5;
    const isCircle=Math.random()>0.5;
    el.style.cssText='left:'+Math.random()*100+'vw;width:'+size+'px;height:'+size+'px;background:'+colors[Math.floor(Math.random()*colors.length)]+';border-radius:'+(isCircle?'50%':'2px')+';animation-duration:'+(Math.random()*2+1.5)+'s;animation-delay:'+(Math.random()*0.5)+'s';
    document.body.appendChild(el);
    setTimeout(function(){el.remove()},4000);
  }
}

/* ========== IMAGE URLS ========== */
const HERO_IMG='https://images.unsplash.com/photo-1519681393784-d120267933ba?w=900&q=75&fit=crop&auto=format';
const SECTION_IMGS={
  network:'https://images.unsplash.com/photo-1448375240586-882707db888b?w=900&q=75&fit=crop&auto=format',
  learn:'https://images.unsplash.com/photo-1532012197267-da84d127e765?w=900&q=75&fit=crop&auto=format',
  social:'https://images.unsplash.com/photo-1519501025264-65ba15a82390?w=900&q=75&fit=crop&auto=format',
  wins:'https://images.unsplash.com/photo-1464822759023-fed622ff2c3b?w=900&q=75&fit=crop&auto=format',
  alfred:'https://images.unsplash.com/photo-1529699211952-734e80c4d42b?w=900&q=75&fit=crop&auto=format',
  vault:'https://images.unsplash.com/photo-1507842217343-583bb7270b66?w=900&q=75&fit=crop&auto=format',
  timemachine:'https://images.unsplash.com/photo-1470071459604-3b5ec3a7fe05?w=900&q=75&fit=crop&auto=format'
};

/* ========== HERO BANNER BUILDER ========== */
function buildHeroBanner(){
  const q=getDailyQuote();
  let h='<div class="hero-banner">';
  h+='<div class="hero-img" style="background-image:url(\''+HERO_IMG+'\')"></div>';
  h+='<div class="hero-overlay"></div>';
  h+='<div class="hero-glow"></div>';
  h+='<div class="hero-bat">'+svgBat(100)+'</div>';
  h+='<div class="hero-quote">"'+esc(q.q)+'"</div>';
  h+='<div class="hero-source">&mdash; '+esc(q.s)+'</div>';
  h+='</div>';
  return h;
}

/* ========== SECTION HERO BUILDER ========== */
function buildSectionHero(cls,icon,title,subtitle,actionHtml){
  const key=cls.replace('sh-','');
  const img=SECTION_IMGS[key]||'';
  let h='<div class="section-hero '+cls+'">';
  if(img)h+='<div class="sh-img" style="background-image:url(\''+img+'\')"></div>';
  h+='<div class="sh-overlay"></div>';
  h+='<div class="sh-content">';
  h+='<div class="sh-icon">'+icon+'</div>';
  h+='<div class="sh-text"><h2>'+title+'</h2><p>'+subtitle+'</p></div>';
  if(actionHtml)h+='<div class="sh-action">'+actionHtml+'</div>';
  h+='</div></div>';
  return h;
}

/* ========== ALFRED GAMEPLAN GENERATOR ========== */
function generateGameplan(){
  const today=todayStr();
  if(data.gameplans[today]&&data.gameplans[today].generated)return data.gameplans[today];
  const plan={date:today,generated:true,briefing:'',tasks:[]};
  const hq=readHQ();
  const yesterday=new Date();yesterday.setDate(yesterday.getDate()-1);
  const ys=yesterday.toISOString().slice(0,10);
  const yStats=data.dailyStats[ys]||{emails:0,calls:0,linkedin:0};
  const et=data.settings.emailTarget||50;const ct=data.settings.callTarget||20;const dt=data.settings.dmTarget||15;
  const hour=new Date().getHours();
  let g=hour<12?'Good morning':hour<17?'Good afternoon':'Good evening';
  let b=g+', sir.\n\n';
  // Yesterday debrief
  b+='YESTERDAY\'S DEBRIEF: '+yStats.emails+'/'+et+' emails, '+yStats.calls+'/'+ct+' calls, '+yStats.linkedin+'/'+dt+' DMs. ';
  const allHit=yStats.emails>=et&&yStats.calls>=ct&&yStats.linkedin>=dt;
  if(allHit)b+='Outstanding performance. Full marks across the board.\n\n';
  else{
    const missed=[];
    if(yStats.emails<et)missed.push('emails ('+(et-yStats.emails)+' short)');
    if(yStats.calls<ct)missed.push('calls ('+(ct-yStats.calls)+' short)');
    if(yStats.linkedin<dt)missed.push('DMs ('+(dt-yStats.linkedin)+' short)');
    b+='We fell short on '+missed.join(', ')+'. Today we close the gap.\n\n';
  }
  // Pipeline analysis
  let closedCount=0;let activeCount=0;
  if(hq&&hq.contacts){
    closedCount=hq.contacts.filter(function(c){return c.status==='Closed'}).length;
    activeCount=hq.contacts.filter(function(c){return!['Closed','Lost','Churned'].includes(c.status)}).length;
    b+='PIPELINE STATUS: '+closedCount+' signed client'+(closedCount!==1?'s':'')+', '+activeCount+' active lead'+(activeCount!==1?'s':'')+'. '+(50-closedCount)+' to go until the goal.\n\n';
  }else{
    b+='PIPELINE: No HQ data found. Open HQ and start loading your leads, sir.\n\n';
  }
  // Network check
  const staleNet=data.network.filter(function(c){
    if(!c.touches||c.touches.length===0)return daysBetween(c.createdAt||todayStr(),todayStr())>=30;
    return daysBetween(c.touches[c.touches.length-1].date,todayStr())>=30;
  });
  if(staleNet.length>0)b+='NETWORK: '+staleNet.length+' connection'+(staleNet.length>1?'s':'')+' you haven\'t reached out to in 30+ days. Relationships are assets — nurture them.\n\n';
  // Day-specific advice
  const dow=new Date().getDay();
  const dayAdvice={
    0:'Sunday: Rest day, sir. Recharge for the week. But if you\'re feeling productive, plan tomorrow\'s outreach.',
    1:'Monday sets the tone for the entire week. Post thought leadership on LinkedIn and hit the phones early.',
    2:'Tuesday: Engage in Facebook groups today. Ask a pain-point question that gets owners talking.',
    3:'Midweek push, sir. Share a data-driven post on LinkedIn — stats and numbers sell.',
    4:'Thursday: Post a CTA in a Facebook group. Make it easy for people to say yes.',
    5:'Friday: Post a short reel on Instagram. People scroll more on Fridays — capture their attention.',
    6:'Saturday: Light day. Review your week, plan next week\'s content, and log your wins.'
  };
  b+='TODAY\'S PLAY: '+(dayAdvice[dow]||'')+'\n\n';
  b+='The mission is clear. Execute the gameplan below. Every task completed moves you closer to 50 clients and $17,500 MRR. Let\'s get to work, sir.';
  plan.briefing=b;
  // Generate tasks
  let tid=0;
  function addTask(section,text,type,priority){
    plan.tasks.push({id:'gp-'+(tid++),section:section,text:text,type:type||'action',priority:priority||'normal',done:false});
  }
  if(hq&&hq.contacts){
    const contacts=hq.contacts;const sends=hq.emailSends||[];
    const activeStatuses=['Lead','Contacted','Replied','Call Scheduled','Proposal Sent'];
    // Overdue follow-ups (highest priority)
    contacts.forEach(function(c){
      if(!activeStatuses.includes(c.status))return;
      if(c.followUpDate&&c.followUpDate<=today)addTask('Pipeline','OVERDUE: Follow up with '+(c.company||c.name)+' — was due '+fmtDate(c.followUpDate),'pipeline','high');
    });
    // Stale active leads
    contacts.forEach(function(c){
      if(!activeStatuses.includes(c.status))return;
      if(c.lastContact&&daysBetween(c.lastContact,today)>=3&&['Contacted','Replied'].includes(c.status))
        addTask('Pipeline','Follow up with '+(c.company||c.name)+' — '+c.status+' for '+daysBetween(c.lastContact,today)+' days','pipeline');
    });
    // Call confirmations
    contacts.forEach(function(c){
      if(c.status==='Call Scheduled'&&c.lastContact&&daysBetween(c.lastContact,today)>=3)
        addTask('Pipeline','Confirm call with '+(c.company||c.name)+' — scheduled '+daysBetween(c.lastContact,today)+' days ago','pipeline');
    });
    // Email sequence gaps
    contacts.forEach(function(c){
      if(!activeStatuses.includes(c.status))return;
      const mySends=sends.filter(function(s){return s.contactId===c.id});
      if(mySends.length>0){
        const last=mySends[mySends.length-1];
        if(last.dateSent&&daysBetween(last.dateSent,today)>=3&&mySends.length<5)
          addTask('Pipeline','Send Email '+(mySends.length+1)+' to '+(c.company||c.name)+' — last email '+daysBetween(last.dateSent,today)+' days ago','pipeline');
      }
    });
    // New leads needed
    const thisWeek=contacts.filter(function(c){return c.createdAt&&daysBetween(c.createdAt,today)<=7});
    if(thisWeek.length<3)addTask('Pipeline','Add new leads to HQ — only '+thisWeek.length+' added this week (aim for 3+)','outreach');
  }else{
    addTask('Pipeline','Open HQ and add your first batch of leads — find 10 landscaping companies today','outreach');
  }
  // Outreach targets
  addTask('Outreach','Send '+et+' emails today','outreach');
  addTask('Outreach','Make '+ct+' calls today','outreach');
  addTask('Outreach','Send '+dt+' LinkedIn DMs today','outreach');
  // Network tasks
  staleNet.slice(0,3).forEach(function(c){
    addTask('Network','Reach out to '+c.name+(c.company?' at '+c.company:'')+' — no contact in 30+ days','network');
  });
  // Birthday tasks
  var bdays=getUpcomingBirthdays();
  bdays.forEach(function(bd){
    var label=bd.daysUntil===0?'TODAY':bd.daysUntil===1?'TOMORROW':'in '+bd.daysUntil+' days';
    addTask('Network','Birthday: '+bd.name+' — '+label+'. Send a message!','birthday');
  });
  // Social tasks by day
  var socialByDay={
    0:[['Plan Monday\'s LinkedIn post','social']],
    1:[['Post thought leadership on LinkedIn','social'],['Comment on 5 LinkedIn posts','social']],
    2:[['Post a question in a Facebook group','social'],['Comment on 5 Facebook group posts','social']],
    3:[['Share a stat/data post on LinkedIn','social'],['Comment on 5 LinkedIn posts','social']],
    4:[['Post a CTA/offer in a Facebook group','social'],['Comment on 5 Facebook group posts','social']],
    5:[['Post a short-form reel on Instagram','social'],['Share reel to Instagram Stories','social']],
    6:[['Review this week\'s social media performance','social'],['Plan next week\'s content calendar','social']]
  };
  if(socialByDay[dow])socialByDay[dow].forEach(function(t){addTask('Social',t[0],t[1])});
  addTask('Social','Post on Instagram (reel or story)','social');
  // Learning
  var randomCard=data.learnCards[Math.floor(Math.random()*data.learnCards.length)];
  if(randomCard)addTask('Learning','Today\'s insight: "'+randomCard.t+'" — check it out in the Learn tab','learn');
  addTask('Learning','Read or watch one piece of business/sales content today','learn');
  // Wins
  addTask('Wins','Log at least 1 win today — even a small one counts','win');
  data.gameplans[today]=plan;save();
  return plan;
}

/* ========== AUTO-TASK GENERATOR ========== */
function generateAutoTasks(){
  const hq=readHQ();const tasks=[];const today=todayStr();
  if(!hq||!hq.contacts)return tasks;
  const contacts=hq.contacts||[];
  const sends=hq.emailSends||[];
  const activeStatuses=['Lead','Contacted','Replied','Call Scheduled','Proposal Sent'];
  contacts.forEach(function(c){
    if(!activeStatuses.includes(c.status))return;
    // Overdue follow-ups
    if(c.followUpDate&&c.followUpDate<=today){
      tasks.push({type:'pipeline',text:'Overdue: Follow up with '+(c.company||c.name)+' — was due '+fmtDate(c.followUpDate),company:c.company||c.name});
    }
    // Stale leads (no contact in 3+ days)
    if(c.lastContact&&daysBetween(c.lastContact,today)>=3&&['Contacted','Replied'].includes(c.status)){
      tasks.push({type:'pipeline',text:'Follow up with '+(c.company||c.name)+' — '+c.status+' for '+daysBetween(c.lastContact,today)+' days',company:c.company||c.name});
    }
    // Call scheduled but stale
    if(c.status==='Call Scheduled'&&c.lastContact&&daysBetween(c.lastContact,today)>=3){
      tasks.push({type:'pipeline',text:'Confirm call with '+(c.company||c.name)+' — scheduled '+daysBetween(c.lastContact,today)+' days ago',company:c.company||c.name});
    }
    // Email sequence gaps
    const mySends=sends.filter(function(s){return s.contactId===c.id});
    if(mySends.length>0){
      const last=mySends[mySends.length-1];
      if(last.dateSent&&daysBetween(last.dateSent,today)>=3){
        const nextNum=mySends.length+1;
        if(nextNum<=5){
          tasks.push({type:'pipeline',text:'Send Email '+nextNum+' to '+(c.company||c.name)+' — last email '+daysBetween(last.dateSent,today)+' days ago',company:c.company||c.name});
        }
      }
    }
  });
  // Low lead volume
  const thisWeek=contacts.filter(function(c){return c.createdAt&&daysBetween(c.createdAt,today)<=7});
  if(thisWeek.length<3){
    tasks.push({type:'outreach',text:'Add new leads to HQ — only '+thisWeek.length+' added this week (aim for 3+)'});
  }
  // Social tasks based on day of week
  const dow=new Date().getDay();
  const socialTasks={
    1:{text:'Monday: Post thought leadership on LinkedIn',type:'social'},
    2:{text:'Tuesday: Post a pain-point question in a Facebook group',type:'social'},
    3:{text:'Wednesday: Share a stat or data post on LinkedIn',type:'social'},
    4:{text:'Thursday: Post a CTA/offer in a Facebook group',type:'social'},
    5:{text:'Friday: Post a short-form reel on Instagram',type:'social'}
  };
  if(socialTasks[dow])tasks.push(socialTasks[dow]);
  return tasks;
}

/* ========== BIRTHDAY CHECKER ========== */
function getUpcomingBirthdays(){
  const now=new Date();const month=now.getMonth()+1;const day=now.getDate();const upcoming=[];
  data.network.forEach(function(c){
    if(!c.bdayMonth||!c.bdayDay)return;
    const bm=parseInt(c.bdayMonth);const bd=parseInt(c.bdayDay);
    let daysUntil;
    const thisYear=now.getFullYear();
    const bDate=new Date(thisYear,bm-1,bd);
    if(bDate<now){bDate.setFullYear(thisYear+1)}
    daysUntil=Math.floor((bDate-now)/(86400000));
    if(daysUntil<=7){upcoming.push({name:c.name,month:bm,day:bd,daysUntil:daysUntil,id:c.id})}
  });
  upcoming.sort(function(a,b){return a.daysUntil-b.daysUntil});
  return upcoming;
}

/* ========== ALFRED BRIEFING ========== */
function generateBriefing(){
  const hour=new Date().getHours();
  let g=hour<12?'Good morning':'Good afternoon';
  if(hour>=17)g='Good evening';
  const hq=readHQ();
  if(!hq||!hq.contacts||hq.contacts.length===0){
    return g+', sir. Your pipeline is empty — time to hunt. Open HQ and start adding leads. Every empire starts with the first prospect. I suggest 10 new companies today.';
  }
  const active=hq.contacts.filter(function(c){return!['Closed','Lost','Churned'].includes(c.status)});
  const closed=hq.contacts.filter(function(c){return c.status==='Closed'});
  const stale=active.filter(function(c){return c.lastContact&&daysBetween(c.lastContact,todayStr())>=3});
  let msg=g+', sir. ';
  if(closed.length>0){
    msg+='You have '+closed.length+' signed client'+(closed.length>1?'s':'')+' and '+active.length+' active lead'+(active.length!==1?'s':'')+' in the pipeline. ';
  }else{
    msg+='You have '+active.length+' lead'+(active.length!==1?'s':'')+' in the pipeline but no signed clients yet. The first one is always the hardest — keep pushing. ';
  }
  if(stale.length>0){
    msg+=stale.length+' lead'+(stale.length>1?'s need':' needs')+' follow-up — don\'t let them go cold. ';
  }
  const clientGoal=50;const remaining=clientGoal-closed.length;
  msg+=remaining+' clients to go until the goal. Today\'s mission: move the pipeline forward. Let\'s get to work.';
  return msg;
}

/* ========== RENDER: TODAY ========== */
function renderToday(){
  const v=document.getElementById('view-today');
  const today=todayStr();const ds=data.dailyStats[today]||{emails:0,calls:0,linkedin:0};
  const et=data.settings.emailTarget||50;const ct=data.settings.callTarget||20;const dt=data.settings.dmTarget||15;
  const autoTasks=generateAutoTasks();
  const birthdays=getUpcomingBirthdays();
  const hq=readHQ();
  const closedCount=hq&&hq.contacts?hq.contacts.filter(function(c){return c.status==='Closed'}).length:0;
  const mrrCalc=hq&&hq.contacts?hq.contacts.filter(function(c){return c.status==='Closed'}).reduce(function(sum,c){
    if(c.customPrice)return sum+Number(c.customPrice);
    const sz=parseInt(c.crewSize)||8;return sum+(sz<=8?299:299+(sz-8)*30);
  },0):0;
  let h='';
  // Hero banner with daily quote
  h+=buildHeroBanner();
  // Briefing
  h+='<div class="briefing card-glow"><div class="greeting">Alfred\'s Briefing</div><div class="msg">'+esc(generateBriefing())+'</div></div>';
  // Birthdays
  if(birthdays.length>0){
    h+='<div class="card birthday-alert" style="background:rgba(255,179,0,0.06);border-color:rgba(255,179,0,0.2)">';
    h+='<h3 style="color:var(--gold)">&#127874; Upcoming Birthdays</h3>';
    birthdays.forEach(function(b){
      const label=b.daysUntil===0?'Today!':b.daysUntil===1?'Tomorrow':'In '+b.daysUntil+' days';
      h+='<div style="padding:4px 0;font-size:13px">'+esc(b.name)+' — '+MONTHS[b.month-1]+' '+b.day+' <span style="color:var(--gold);font-weight:600">('+label+')</span></div>';
    });
    h+='</div>';
  }
  // Pipeline tasks
  if(autoTasks.length>0){
    h+='<div class="card"><h3><span style="color:var(--sky)">&#9889;</span> Pipeline & Growth Tasks</h3>';
    autoTasks.forEach(function(t,i){
      const tagClass=t.type==='pipeline'?'tag-pipeline':t.type==='social'?'tag-social':'tag-outreach';
      h+='<div class="task-item"><span class="task-tag '+tagClass+'">'+esc(t.type)+'</span>';
      h+='<span class="task-text">'+esc(t.text)+'</span>';
      if(t.type==='pipeline')h+='<button class="hq-btn" onclick="openHQ()">Open HQ</button>';
      h+='</div>';
    });
    h+='</div>';
  }
  // Outreach counters
  h+='<div class="card"><h3><span style="color:var(--gold)">&#128200;</span> Daily Outreach</h3>';
  h+='<div class="outreach-grid">';
  // Emails
  h+='<div class="outreach-item"><div class="outreach-label">Emails</div>';
  h+='<div class="outreach-count emails">'+ds.emails+'<span style="font-size:14px;color:var(--dim)"> / '+et+'</span></div>';
  h+='<div class="outreach-bar"><div class="outreach-fill" style="width:'+Math.min(100,ds.emails/et*100)+'%;background:var(--gold)"></div></div>';
  h+='<div class="outreach-btns"><button onclick="adjustOutreach(\'emails\',-1)">−</button><button onclick="adjustOutreach(\'emails\',1)">+</button></div></div>';
  // Calls
  h+='<div class="outreach-item"><div class="outreach-label">Calls</div>';
  h+='<div class="outreach-count calls">'+ds.calls+'<span style="font-size:14px;color:var(--dim)"> / '+ct+'</span></div>';
  h+='<div class="outreach-bar"><div class="outreach-fill" style="width:'+Math.min(100,ds.calls/ct*100)+'%;background:var(--emerald)"></div></div>';
  h+='<div class="outreach-btns"><button onclick="adjustOutreach(\'calls\',-1)">−</button><button onclick="adjustOutreach(\'calls\',1)">+</button></div></div>';
  // DMs
  h+='<div class="outreach-item"><div class="outreach-label">LinkedIn DMs</div>';
  h+='<div class="outreach-count dms">'+ds.linkedin+'<span style="font-size:14px;color:var(--dim)"> / '+dt+'</span></div>';
  h+='<div class="outreach-bar"><div class="outreach-fill" style="width:'+Math.min(100,ds.linkedin/dt*100)+'%;background:var(--sky)"></div></div>';
  h+='<div class="outreach-btns"><button onclick="adjustOutreach(\'linkedin\',-1)">−</button><button onclick="adjustOutreach(\'linkedin\',1)">+</button></div></div>';
  h+='</div></div>';
  // Manual tasks
  h+='<div class="card"><h3><span style="color:var(--violet)">&#9745;</span> My Tasks</h3>';
  const todayTasks=data.manualTasks.filter(function(t){return t.date===today});
  todayTasks.forEach(function(t){
    h+='<div class="task-item'+(t.completed?' completed':'')+'">';
    h+='<div class="task-check'+(t.completed?' checked':'')+'" onclick="toggleManualTask(\''+t.id+'\')"></div>';
    h+='<span class="task-text">'+esc(t.text)+'</span>';
    h+='<button class="hq-btn" style="border-color:rgba(255,107,107,0.3);color:var(--coral)" onclick="deleteManualTask(\''+t.id+'\')">&#10005;</button>';
    h+='</div>';
  });
  h+='<div class="add-task-row"><input id="new-task-input" placeholder="Add a task..." onkeydown="if(event.key===\'Enter\')addManualTask()"><button onclick="addManualTask()">Add</button></div>';
  h+='</div>';
  // Streak + Goal
  h+='<div class="streak-bar"><span class="streak-fire">&#128293;</span><span class="streak-num">'+data.streak+'</span><span class="streak-label">day streak</span></div>';
  h+='<div class="goal-bar"><span class="goal-text"><strong>'+closedCount+'</strong> / 50 clients</span>';
  h+='<div class="goal-progress"><div class="fill" style="width:'+(closedCount/50*100)+'%"></div></div>';
  h+='<span class="goal-text">$<strong>'+mrrCalc.toLocaleString()+'</strong> / $17,500 MRR</span></div>';
  v.innerHTML=h;
}

/* ========== TODAY FUNCTIONS ========== */
function adjustOutreach(key,delta){
  const today=todayStr();if(!data.dailyStats[today])data.dailyStats[today]={emails:0,calls:0,linkedin:0};
  data.dailyStats[today][key]=Math.max(0,(data.dailyStats[today][key]||0)+delta);
  save();renderToday();
}
function addManualTask(){
  const inp=document.getElementById('new-task-input');const text=inp.value.trim();
  if(!text)return;
  data.manualTasks.push({id:uid(),text:text,completed:false,date:todayStr()});
  save();renderToday();
}
function toggleManualTask(id){
  const t=data.manualTasks.find(function(x){return x.id===id});
  if(t){t.completed=!t.completed;save();renderToday()}
}
function deleteManualTask(id){
  data.manualTasks=data.manualTasks.filter(function(x){return x.id!==id});
  save();renderToday();
}
function openHQ(){window.open('../Business Analytics/crew-voice-hq.html','_blank')}

/* ========== RENDER: ALFRED (DAILY GAMEPLAN) ========== */
function renderAlfred(){
  const v=document.getElementById('view-alfred');
  const plan=generateGameplan();
  let h='';
  // Header
  h+=buildSectionHero('sh-alfred','&#129488;','Alfred\'s Daily Gameplan','Prepared at 3:00 AM — '+fmtDate(todayStr()),'<button class="btn btn-outline" style="font-size:11px" onclick="regenerateGameplan()">&#x21bb; Regenerate</button>');
  // Briefing
  h+='<div class="briefing card-glow"><div class="greeting">MORNING BRIEFING</div>';
  h+='<div class="msg">'+esc(plan.briefing).replace(/\n/g,'<br>')+'</div></div>';
  // Tasks grouped by section
  var sections=['Pipeline','Outreach','Network','Social','Learning','Wins'];
  var sectionIcons={Pipeline:'&#127919;',Outreach:'&#128231;',Network:'&#129309;',Social:'&#128241;',Learning:'&#128218;',Wins:'&#127942;'};
  var sectionColors={Pipeline:'var(--sky)',Outreach:'var(--gold)',Network:'var(--violet)',Social:'var(--rose)',Learning:'var(--emerald)',Wins:'var(--amber)'};
  sections.forEach(function(section){
    var tasks=plan.tasks.filter(function(t){return t.section===section});
    if(tasks.length===0)return;
    var done=tasks.filter(function(t){return t.done}).length;
    h+='<div class="card"><h3><span style="color:'+sectionColors[section]+'">'+sectionIcons[section]+'</span> '+section;
    h+=' <span style="margin-left:auto;font-size:12px;color:'+(done===tasks.length?'var(--emerald)':'var(--dim)')+'">'+done+'/'+tasks.length+'</span></h3>';
    tasks.forEach(function(t){
      var tagClass=t.type==='pipeline'?'tag-pipeline':t.type==='social'?'tag-social':t.type==='outreach'?'tag-outreach':'tag-manual';
      h+='<div class="task-item'+(t.done?' completed':'')+'">';
      h+='<div class="task-check'+(t.done?' checked':'')+'" onclick="toggleGameplanTask(\''+t.id+'\')"></div>';
      h+='<span class="task-text">'+(t.priority==='high'?'<strong style="color:var(--coral)">':'')+ esc(t.text)+(t.priority==='high'?'</strong>':'')+'</span>';
      if(t.type==='pipeline')h+='<button class="hq-btn" onclick="openHQ()">Open HQ</button>';
      h+='</div>';
    });
    h+='</div>';
  });
  // Overall progress
  var totalTasks=plan.tasks.length;var doneTasks=plan.tasks.filter(function(t){return t.done}).length;
  var pct=totalTasks>0?Math.round(doneTasks/totalTasks*100):0;
  h+='<div class="card" style="text-align:center"><h3 style="justify-content:center">Today\'s Progress</h3>';
  h+='<div style="font-size:42px;font-weight:800;color:'+(pct>=100?'var(--emerald)':pct>=50?'var(--gold)':'var(--coral)')+'">'+pct+'%</div>';
  h+='<div class="outreach-bar" style="margin-top:8px"><div class="outreach-fill" style="width:'+pct+'%;background:'+(pct>=100?'var(--emerald)':'linear-gradient(90deg,var(--gold),var(--emerald))')+'"></div></div>';
  h+='<div style="font-size:13px;color:var(--dim);margin-top:8px">'+doneTasks+' of '+totalTasks+' tasks completed</div>';
  if(pct>=100)h+='<div style="color:var(--emerald);font-weight:700;margin-top:8px;font-size:15px">Mission Complete. Outstanding work, sir. &#128081;</div>';
  h+='</div>';
  // Regenerate
  h+='<div style="text-align:center;margin-top:12px"><button class="btn btn-outline" onclick="regenerateGameplan()">&#x21bb; Regenerate Gameplan</button></div>';
  v.innerHTML=h;
}
function toggleGameplanTask(taskId){
  var today=todayStr();var plan=data.gameplans[today];if(!plan)return;
  var task=plan.tasks.find(function(t){return t.id===taskId});
  if(task){task.done=!task.done;save();renderAlfred()}
}
function regenerateGameplan(){
  var today=todayStr();delete data.gameplans[today];save();renderAlfred();
}

/* ========== RENDER: NETWORK ========== */
let netFilter='All';let netSearch='';
function renderNetwork(){
  const v=document.getElementById('view-network');
  let h=buildSectionHero('sh-network','&#127760;','Network','Your relationships are your net worth.','<button class="btn btn-gold" style="font-size:12px" onclick="openNetModal()">+ Add Contact</button>');
  // Search
  h+='<input class="search-box" placeholder="Search contacts..." oninput="netSearch=this.value;renderNetwork()" value="'+esc(netSearch)+'">';
  // Filters
  const cats=['All','Mentor','Peer','Partner','Industry','Referral'];
  h+='<div class="net-filters">';
  cats.forEach(function(c){h+='<button class="'+(netFilter===c?'active':'')+'" onclick="netFilter=\''+c+'\';renderNetwork()">'+c+'</button>'});
  h+='</div>';
  // Reach-out alerts
  const stale=data.network.filter(function(c){
    if(!c.touches||c.touches.length===0)return daysBetween(c.createdAt||todayStr(),todayStr())>=30;
    const last=c.touches[c.touches.length-1].date;
    return daysBetween(last,todayStr())>=30;
  });
  if(stale.length>0){
    h+='<div class="net-alert">&#9888; '+stale.length+' contact'+(stale.length>1?'s':'')+'  you haven\'t reached out to in 30+ days:</div>';
    stale.forEach(function(c){
      const lastDate=c.touches&&c.touches.length>0?c.touches[c.touches.length-1].date:c.createdAt;
      h+='<div class="task-item" style="margin-bottom:4px"><span class="task-text" style="color:var(--coral)">'+esc(c.name)+' — '+daysBetween(lastDate||todayStr(),todayStr())+' days ago</span>';
      h+='<button class="hq-btn" onclick="openTouchModal(\''+c.id+'\')">Log Touch</button></div>';
    });
    h+='<div style="margin-bottom:16px"></div>';
  }
  // Birthdays this month
  const bdays=getUpcomingBirthdays();
  if(bdays.length>0){
    h+='<div class="card birthday-alert" style="margin-bottom:16px;background:rgba(255,179,0,0.06);border-color:rgba(255,179,0,0.15)">';
    h+='<div style="font-weight:700;color:var(--gold);margin-bottom:8px">&#127874; Upcoming Birthdays</div>';
    bdays.forEach(function(b){
      const label=b.daysUntil===0?'Today!':b.daysUntil===1?'Tomorrow':'In '+b.daysUntil+' days';
      h+='<div style="font-size:13px;padding:2px 0">'+esc(b.name)+' — '+MONTHS[b.month-1]+' '+b.day+' ('+label+')</div>';
    });
    h+='</div>';
  }
  // Contact list
  let filtered=data.network;
  if(netFilter!=='All')filtered=filtered.filter(function(c){return c.category===netFilter});
  if(netSearch)filtered=filtered.filter(function(c){return(c.name+' '+c.company).toLowerCase().includes(netSearch.toLowerCase())});
  if(filtered.length===0){
    h+='<div class="empty">No contacts yet. Start building your network!</div>';
  }else{
    filtered.forEach(function(c){
      const stars='&#9733;'.repeat(c.strength||0)+'&#9734;'.repeat(5-(c.strength||0));
      const lastTouch=c.touches&&c.touches.length>0?c.touches[c.touches.length-1]:null;
      const bday=c.bdayMonth&&c.bdayDay?MONTHS[c.bdayMonth-1]+' '+c.bdayDay:'';
      h+='<div class="net-card"><div class="net-info">';
      h+='<div class="net-stars">'+stars+'</div>';
      h+='<div class="net-name">'+esc(c.name)+'</div>';
      h+='<div class="net-meta">'+esc(c.company||'')+(c.role?' · '+esc(c.role):'')+(c.category?' · '+esc(c.category):'')+'</div>';
      if(bday)h+='<div class="net-meta">&#127874; '+bday+'</div>';
      if(lastTouch)h+='<div class="net-meta">Last: '+esc(lastTouch.type)+' on '+fmtDate(lastTouch.date)+'</div>';
      if(c.notes)h+='<div class="net-meta" style="margin-top:4px;color:var(--text);font-style:italic">'+esc(c.notes)+'</div>';
      h+='<div class="net-actions">';
      if(c.linkedin)h+='<button onclick="window.open(\''+esc(c.linkedin)+'\',\'_blank\')">LinkedIn</button>';
      h+='<button onclick="openTouchModal(\''+c.id+'\')">Log Touch</button>';
      h+='<button onclick="openNetModal(\''+c.id+'\')">Edit</button>';
      h+='</div></div></div>';
    });
  }
  v.innerHTML=h;
}

/* ========== NETWORK FUNCTIONS ========== */
let netStarVal=3;
function openNetModal(editId){
  const isEdit=!!editId;
  document.getElementById('net-modal-title').textContent=isEdit?'Edit Contact':'Add Contact';
  document.getElementById('net-delete-btn').style.display=isEdit?'block':'none';
  // Populate day options
  const daySelect=document.getElementById('net-bday-day');
  daySelect.innerHTML='<option value="">Day</option>';
  for(let i=1;i<=31;i++)daySelect.innerHTML+='<option value="'+i+'">'+i+'</option>';
  if(isEdit){
    const c=data.network.find(function(x){return x.id===editId});
    if(!c)return;
    document.getElementById('net-edit-id').value=c.id;
    document.getElementById('net-name').value=c.name||'';
    document.getElementById('net-company').value=c.company||'';
    document.getElementById('net-role').value=c.role||'';
    document.getElementById('net-category').value=c.category||'Peer';
    document.getElementById('net-howmet').value=c.howMet||'';
    document.getElementById('net-linkedin').value=c.linkedin||'';
    document.getElementById('net-phone').value=c.phone||'';
    document.getElementById('net-email').value=c.email||'';
    document.getElementById('net-bday-month').value=c.bdayMonth||'';
    document.getElementById('net-bday-day').value=c.bdayDay||'';
    document.getElementById('net-notes').value=c.notes||'';
    netStarVal=c.strength||3;
  }else{
    document.getElementById('net-edit-id').value='';
    ['net-name','net-company','net-role','net-howmet','net-linkedin','net-phone','net-email','net-notes'].forEach(function(id){document.getElementById(id).value=''});
    document.getElementById('net-category').value='Peer';
    document.getElementById('net-bday-month').value='';
    document.getElementById('net-bday-day').value='';
    netStarVal=3;
  }
  renderStars();
  openModal('networkModal');
}
function renderStars(){
  const cont=document.getElementById('net-stars');let h='';
  for(let i=1;i<=5;i++){
    h+='<span class="'+(i<=netStarVal?'lit':'')+'" onclick="netStarVal='+i+';renderStars()">&#9733;</span>';
  }
  cont.innerHTML=h;
}
function saveNetContact(){
  const id=document.getElementById('net-edit-id').value;
  const obj={
    name:document.getElementById('net-name').value.trim(),
    company:document.getElementById('net-company').value.trim(),
    role:document.getElementById('net-role').value.trim(),
    category:document.getElementById('net-category').value,
    howMet:document.getElementById('net-howmet').value.trim(),
    linkedin:document.getElementById('net-linkedin').value.trim(),
    phone:document.getElementById('net-phone').value.trim(),
    email:document.getElementById('net-email').value.trim(),
    bdayMonth:document.getElementById('net-bday-month').value,
    bdayDay:document.getElementById('net-bday-day').value,
    notes:document.getElementById('net-notes').value.trim(),
    strength:netStarVal
  };
  if(!obj.name){alert('Name is required');return}
  if(id){
    const c=data.network.find(function(x){return x.id===id});
    if(c)Object.assign(c,obj);
  }else{
    obj.id=uid();obj.touches=[];obj.createdAt=todayStr();
    data.network.push(obj);
  }
  save();closeModal('networkModal');renderNetwork();
}
function deleteNetContact(){
  const id=document.getElementById('net-edit-id').value;
  if(!id)return;
  if(!confirm('Delete this contact?'))return;
  data.network=data.network.filter(function(x){return x.id!==id});
  save();closeModal('networkModal');renderNetwork();
}
function openTouchModal(contactId){
  document.getElementById('touch-contact-id').value=contactId;
  document.getElementById('touch-date').value=todayStr();
  document.getElementById('touch-notes').value='';
  document.getElementById('touch-type').value='Call';
  openModal('touchModal');
}
function saveTouch(){
  const cid=document.getElementById('touch-contact-id').value;
  const c=data.network.find(function(x){return x.id===cid});
  if(!c)return;
  if(!c.touches)c.touches=[];
  c.touches.push({
    type:document.getElementById('touch-type').value,
    date:document.getElementById('touch-date').value,
    notes:document.getElementById('touch-notes').value.trim()
  });
  save();closeModal('touchModal');renderNetwork();
}

/* ========== RENDER: LEARN ========== */
function renderLearn(){
  const v=document.getElementById('view-learn');
  const cards=data.learnCards;
  const cats=['All','Sales','Network','Growth','Comms','Leadership','Industry','Social','Mindset','Saved'];
  let filtered=cards;
  if(data.learnFilter==='Saved'){
    filtered=cards.filter(function(c){return data.savedCardIds.includes(c.id)});
  }else if(data.learnFilter&&data.learnFilter!=='All'){
    filtered=cards.filter(function(c){return c.c===data.learnFilter});
  }
  if(filtered.length===0)filtered=[{id:'empty',t:'No Cards',c:'Mindset',d:'Add your own cards or switch categories!'}];
  const idx=Math.min(data.learnIndex||0,filtered.length-1);
  const card=filtered[idx>=0?idx:0];
  const isSaved=data.savedCardIds.includes(card.id);
  const catClass='cat-'+(card.c||'mindset').toLowerCase();
  let h=buildSectionHero('sh-learn','&#128218;','Learn','Replace the scroll. Feed your mind.');
  // Tabs
  h+='<div class="learn-tabs">';
  cats.forEach(function(c){h+='<button class="'+(data.learnFilter===c||(c==='All'&&!data.learnFilter)?'active':'')+'" onclick="data.learnFilter=\''+c+'\';data.learnIndex=0;save();renderLearn()">'+c+'</button>'});
  h+='</div>';
  // Card
  h+='<div class="learn-card-container"><div class="learn-card">';
  h+='<div class="cat-tag '+catClass+'">'+esc(card.c)+'</div>';
  h+='<div class="card-title">'+esc(card.t)+'</div>';
  h+='<div class="card-body">'+esc(card.d)+'</div>';
  if(card.id!=='empty'){
    h+='<button class="save-btn'+(isSaved?' saved':'')+'" onclick="toggleSaveCard(\''+card.id+'\')">'+(isSaved?'&#11088; Saved':'&#128278; Save')+'</button>';
  }
  h+='</div></div>';
  // Nav
  h+='<div class="learn-nav">';
  h+='<button onclick="learnPrev()">&larr; Previous</button>';
  h+='<button onclick="learnNext()">Next &rarr;</button>';
  h+='</div>';
  h+='<div class="learn-counter">'+(idx+1)+' / '+filtered.length+' cards</div>';
  h+='<div style="text-align:center;margin-top:16px"><button class="btn btn-outline" onclick="openModal(\'learnModal\')">+ Add Your Own Card</button></div>';
  v.innerHTML=h;
}
function learnNext(){
  const cards=getFilteredLearnCards();
  data.learnIndex=((data.learnIndex||0)+1)%cards.length;
  save();renderLearn();
}
function learnPrev(){
  const cards=getFilteredLearnCards();
  data.learnIndex=((data.learnIndex||0)-1+cards.length)%cards.length;
  save();renderLearn();
}
function getFilteredLearnCards(){
  if(data.learnFilter==='Saved')return data.learnCards.filter(function(c){return data.savedCardIds.includes(c.id)});
  if(data.learnFilter&&data.learnFilter!=='All')return data.learnCards.filter(function(c){return c.c===data.learnFilter});
  return data.learnCards;
}
function toggleSaveCard(id){
  const idx=data.savedCardIds.indexOf(id);
  if(idx>=0)data.savedCardIds.splice(idx,1);else data.savedCardIds.push(id);
  save();renderLearn();
}
function saveLearnCard(){
  const t=document.getElementById('learn-title').value.trim();
  const c=document.getElementById('learn-category').value;
  const d=document.getElementById('learn-body').value.trim();
  if(!t||!d){alert('Title and insight are required');return}
  data.learnCards.push({id:uid(),t:t,c:c,d:d,custom:true});
  save();closeModal('learnModal');renderLearn();
}

/* ========== RENDER: SOCIAL ========== */
function renderSocial(){
  const v=document.getElementById('view-social');
  const tab=data.socialTab||'ig';
  let h=buildSectionHero('sh-social','&#128241;','Social Media','Consistency beats virality. Show up every day.');
  // Tabs
  h+='<div class="social-tabs">';
  h+='<button class="'+(tab==='li'?'active-li':'')+'" onclick="data.socialTab=\'li\';save();renderSocial()">&#128188; LinkedIn</button>';
  h+='<button class="'+(tab==='ig'?'active-ig':'')+'" onclick="data.socialTab=\'ig\';save();renderSocial()">&#128248; Instagram</button>';
  h+='<button class="'+(tab==='fb'?'active-fb':'')+'" onclick="data.socialTab=\'fb\';save();renderSocial()">&#128077; Facebook</button>';
  h+='<button class="'+(tab==='ideas'?'active-ideas':'')+'" onclick="data.socialTab=\'ideas\';save();renderSocial()">&#128161; Content Ideas</button>';
  h+='</div>';
  if(tab==='li')h+=renderSocialLI();
  else if(tab==='ig')h+=renderSocialIG();
  else if(tab==='fb')h+=renderSocialFB();
  else h+=renderSocialIdeas();
  v.innerHTML=h;
}
function renderSocialIG(){
  const today=todayStr();
  const cl=data.socialChecklist[today]||{};
  const igTasks=[
    {id:'ig-reel',label:'Post a Reel (use trending audio)'},
    {id:'ig-story',label:'Post 3 Instagram Stories'},
    {id:'ig-engage',label:'Like & comment on 10 posts in your niche'},
    {id:'ig-hashtag',label:'Research & use 5 targeted hashtags'},
    {id:'ig-dm',label:'DM 5 new prospects or connections'},
    {id:'ig-reply',label:'Reply to all comments and DMs'}
  ];
  let h='';
  // Quick launch
  h+='<div style="text-align:center;margin-bottom:20px">';
  if(data.settings.instagram)h+='<a href="'+esc(data.settings.instagram)+'" target="_blank" class="platform-launch ig">Open Instagram &#8599;</a>';
  else h+='<button class="platform-launch ig" onclick="openModal(\'settingsModal\')">Set Instagram URL in Settings</button>';
  h+='</div>';
  // Follower tracker
  h+='<div class="card"><h3 style="color:var(--ig-pink)">&#128200; Follower Tracker</h3>';
  const latestFollowers=data.igFollowers&&data.igFollowers.length>0?data.igFollowers[data.igFollowers.length-1]:{count:0,date:''};
  h+='<div class="follower-log"><div><div class="follower-count" style="color:var(--ig-pink)">'+(latestFollowers.count||0)+'</div>';
  h+='<div class="follower-label">Current Followers</div></div>';
  h+='<div style="margin-left:auto;text-align:right"><input class="follower-input" type="number" id="ig-follower-input" placeholder="Update" value="">';
  h+='<button class="btn btn-gold" style="margin-top:6px;font-size:11px;padding:6px 12px" onclick="logIGFollowers()">Log</button></div></div>';
  if(data.igFollowers&&data.igFollowers.length>1){
    const prev=data.igFollowers[data.igFollowers.length-2];
    const diff=latestFollowers.count-prev.count;
    h+='<div style="font-size:12px;color:'+(diff>=0?'var(--emerald)':'var(--coral)')+'">'+
      (diff>=0?'+':'')+diff+' since '+fmtDate(prev.date)+'</div>';
  }
  h+='</div>';
  // Daily checklist
  h+='<div class="card"><h3 style="color:var(--ig-pink)">&#9745; Daily Instagram Tasks</h3>';
  igTasks.forEach(function(t){
    const done=!!cl[t.id];
    h+='<div class="checklist-item'+(done?' done':'')+'" onclick="toggleSocialCheck(\''+t.id+'\')">';
    h+='<div class="cl-check'+(done?' checked':'')+'"></div>';
    h+='<span class="cl-text">'+esc(t.label)+'</span></div>';
  });
  // Custom items
  data.customSocialItems.filter(function(i){return i.platform==='ig'}).forEach(function(i){
    const done=!!cl[i.id];
    h+='<div class="checklist-item'+(done?' done':'')+'" onclick="toggleSocialCheck(\''+i.id+'\')">';
    h+='<div class="cl-check'+(done?' checked':'')+'"></div>';
    h+='<span class="cl-text">'+esc(i.label)+'</span>';
    h+='<button style="background:none;border:none;color:var(--coral);cursor:pointer;font-size:14px" onclick="event.stopPropagation();removeCustomSocial(\''+i.id+'\')">&#10005;</button></div>';
  });
  h+='<div class="add-task-row"><input id="ig-custom-input" placeholder="Add custom IG task..." onkeydown="if(event.key===\'Enter\')addCustomSocial(\'ig\')"><button onclick="addCustomSocial(\'ig\')">Add</button></div>';
  h+='</div>';
  // Tips
  h+='<div class="card" style="border-color:rgba(225,48,108,0.2)"><h3 style="color:var(--ig-pink)">&#128640; IG Growth Tips</h3>';
  h+='<div style="font-size:13px;color:var(--dim);line-height:1.6">';
  h+='&#8226; Post reels at 7 AM, 12 PM, or 6 PM for best reach<br>';
  h+='&#8226; Use 3-5 targeted hashtags (not 30 generic ones)<br>';
  h+='&#8226; First 1.5 seconds of your reel determine if people watch<br>';
  h+='&#8226; Reply to every comment within 1 hour to boost engagement<br>';
  h+='&#8226; Share your reels to Stories for 2x the reach</div></div>';
  return h;
}
function renderSocialFB(){
  const today=todayStr();
  const cl=data.socialChecklist[today]||{};
  const fbTasks=[
    {id:'fb-group-post',label:'Post value content in a Facebook group'},
    {id:'fb-comment',label:'Comment on 5 posts in your target groups'},
    {id:'fb-engage',label:'Like & engage with industry posts'},
    {id:'fb-dm',label:'Send 3 value-first DMs to group members'},
    {id:'fb-page',label:'Post on your business page'},
    {id:'fb-reply',label:'Reply to all comments and messages'}
  ];
  let h='';
  // Quick launch
  h+='<div style="text-align:center;margin-bottom:20px">';
  if(data.settings.facebook)h+='<a href="'+esc(data.settings.facebook)+'" target="_blank" class="platform-launch fb">Open Facebook &#8599;</a>';
  else h+='<button class="platform-launch fb" onclick="openModal(\'settingsModal\')">Set Facebook URL in Settings</button>';
  h+='</div>';
  // FB Groups
  h+='<div class="card"><h3 style="color:var(--fb)">&#128101; My Facebook Groups</h3>';
  if(!data.fbGroups||data.fbGroups.length===0){
    h+='<div class="empty" style="padding:16px">Add the Facebook groups you want to be active in</div>';
  }else{
    data.fbGroups.forEach(function(g){
      h+='<div class="group-item"><a href="'+esc(g.url)+'" target="_blank">'+esc(g.name)+'</a>';
      h+='<button onclick="removeFBGroup(\''+g.id+'\')">&#10005;</button></div>';
    });
  }
  h+='<div style="margin-top:8px"><button class="btn btn-outline" style="font-size:12px" onclick="openModal(\'groupModal\')">+ Add Group</button></div></div>';
  // Daily checklist
  h+='<div class="card"><h3 style="color:var(--fb)">&#9745; Daily Facebook Tasks</h3>';
  fbTasks.forEach(function(t){
    const done=!!cl[t.id];
    h+='<div class="checklist-item'+(done?' done':'')+'" onclick="toggleSocialCheck(\''+t.id+'\')">';
    h+='<div class="cl-check'+(done?' checked':'')+'"></div>';
    h+='<span class="cl-text">'+esc(t.label)+'</span></div>';
  });
  data.customSocialItems.filter(function(i){return i.platform==='fb'}).forEach(function(i){
    const done=!!cl[i.id];
    h+='<div class="checklist-item'+(done?' done':'')+'" onclick="toggleSocialCheck(\''+i.id+'\')">';
    h+='<div class="cl-check'+(done?' checked':'')+'"></div>';
    h+='<span class="cl-text">'+esc(i.label)+'</span>';
    h+='<button style="background:none;border:none;color:var(--coral);cursor:pointer;font-size:14px" onclick="event.stopPropagation();removeCustomSocial(\''+i.id+'\')">&#10005;</button></div>';
  });
  h+='<div class="add-task-row"><input id="fb-custom-input" placeholder="Add custom FB task..." onkeydown="if(event.key===\'Enter\')addCustomSocial(\'fb\')"><button onclick="addCustomSocial(\'fb\')">Add</button></div>';
  h+='</div>';
  // Tips
  h+='<div class="card" style="border-color:rgba(24,119,242,0.2)"><h3 style="color:var(--fb)">&#128640; FB Growth Tips</h3>';
  h+='<div style="font-size:13px;color:var(--dim);line-height:1.6">';
  h+='&#8226; Best posting times: 6-7 AM or 8-9 PM when owners are free<br>';
  h+='&#8226; Ask questions in your posts to drive engagement<br>';
  h+='&#8226; Comment on 5 posts for every 1 you make<br>';
  h+='&#8226; Be helpful for 30 days before pitching in any group<br>';
  h+='&#8226; Use polls and questions — they get 2x more engagement</div></div>';
  return h;
}
function renderSocialIdeas(){
  let h='<div class="card"><h3 style="color:var(--gold)">&#128161; Content Ideas Library</h3>';
  CONTENT_IDEAS.forEach(function(idea){
    h+='<div class="content-idea"><div class="idea-title">'+esc(idea.t)+'</div>';
    h+='<div class="idea-desc">'+esc(idea.d)+'</div>';
    h+='<div class="idea-platform">'+esc(idea.p)+'</div></div>';
  });
  h+='</div>';
  return h;
}

function renderSocialLI(){
  const today=todayStr();
  const cl=data.socialChecklist[today]||{};
  const liTasks=[
    {id:'li-post',label:'Post thought leadership content'},
    {id:'li-comment',label:'Comment on 5 industry posts'},
    {id:'li-dm',label:'Send 15 LinkedIn DMs to prospects'},
    {id:'li-engage',label:'Engage with 5 prospect posts'},
    {id:'li-value',label:'Share a value post or article'},
    {id:'li-reply',label:'Reply to all comments and messages'}
  ];
  let h='';
  // Quick launch
  h+='<div style="text-align:center;margin-bottom:20px">';
  h+='<a class="platform-launch li" href="'+(data.settings.linkedin||'https://linkedin.com')+'" target="_blank">&#128188; Open LinkedIn &rarr;</a>';
  h+='</div>';
  // Connection tracker
  h+='<div class="card"><h3 style="color:#0A66C2">&#128200; Connection Tracker</h3>';
  const latestLI=data.liFollowers&&data.liFollowers.length>0?data.liFollowers[data.liFollowers.length-1]:{count:0,date:''};
  h+='<div class="follower-log"><div><div class="follower-count" style="color:#0A66C2">'+(latestLI.count||0)+'</div>';
  h+='<div style="font-size:12px;color:var(--dim)">connections</div></div>';
  h+='<div style="display:flex;gap:8px;align-items:center"><input type="number" id="li-connection-input" placeholder="Update count" style="width:100px">';
  h+='<button class="btn btn-outline" onclick="logLIConnections()" style="font-size:11px;padding:6px 12px">Log</button></div></div>';
  if(data.liFollowers&&data.liFollowers.length>1){
    const prev=data.liFollowers[data.liFollowers.length-2];
    const diff=latestLI.count-prev.count;
    const arrow=diff>=0?'&#9650;':'&#9660;';
    const color=diff>=0?'var(--emerald)':'var(--coral)';
    h+='<div style="font-size:12px;margin-top:8px;color:'+color+'">'+arrow+' '+(diff>=0?'+':'')+diff+' since '+fmtDate(prev.date)+'</div>';
  }
  h+='</div>';
  // Daily tasks
  h+='<div class="card"><h3 style="color:#0A66C2">&#9745; Daily LinkedIn Tasks</h3>';
  liTasks.forEach(function(t){
    const done=cl[t.id];
    h+='<div class="checklist-item'+(done?' done':'')+'" onclick="toggleSocialCheck(\''+t.id+'\')">';
    h+='<div class="cl-check" style="'+(done?'background:#0A66C2;border-color:#0A66C2':'')+'">'+
      (done?'<span style="color:#fff;font-size:11px">&#10003;</span>':'')+'</div>';
    h+='<span class="cl-text">'+t.label+'</span></div>';
  });
  // Custom tasks
  const liCustom=data.customSocialItems.filter(function(i){return i.platform==='li'});
  liCustom.forEach(function(t){
    const done=cl[t.id];
    h+='<div class="checklist-item'+(done?' done':'')+'" onclick="toggleSocialCheck(\''+t.id+'\')">';
    h+='<div class="cl-check" style="'+(done?'background:#0A66C2;border-color:#0A66C2':'')+'">'+
      (done?'<span style="color:#fff;font-size:11px">&#10003;</span>':'')+'</div>';
    h+='<span class="cl-text">'+esc(t.label)+'</span>';
    h+='<span style="margin-left:auto;font-size:11px;color:var(--coral);cursor:pointer" onclick="event.stopPropagation();removeCustomSocial(\''+t.id+'\')">&#10005;</span></div>';
  });
  h+='<div class="add-task-row"><input id="li-custom-input" placeholder="Add custom LinkedIn task..." onkeydown="if(event.key===\'Enter\')addCustomSocial(\'li\')"><button onclick="addCustomSocial(\'li\')">Add</button></div>';
  h+='</div>';
  // Tips
  h+='<div class="card" style="border-color:rgba(10,102,194,0.2)"><h3 style="color:#0A66C2">&#128640; LinkedIn Growth Tips</h3>';
  h+='<div style="font-size:13px;color:var(--dim);line-height:1.6">';
  h+='&#8226; Best posting times: 7-8 AM on weekdays<br>';
  h+='&#8226; Post thought leadership 3-5x per week<br>';
  h+='&#8226; Comment on others\' posts before posting your own<br>';
  h+='&#8226; Use storytelling — personal stories get 3x more engagement<br>';
  h+='&#8226; Always end posts with a question to drive comments<br>';
  h+='&#8226; DM new connections within 24 hours with a personal note</div></div>';
  return h;
}

/* ========== SOCIAL FUNCTIONS ========== */
function toggleSocialCheck(id){
  const today=todayStr();
  if(!data.socialChecklist[today])data.socialChecklist[today]={};
  data.socialChecklist[today][id]=!data.socialChecklist[today][id];
  save();renderSocial();
}
function addCustomSocial(platform){
  const inp=document.getElementById(platform+'-custom-input');
  const text=inp.value.trim();if(!text)return;
  data.customSocialItems.push({id:uid(),label:text,platform:platform});
  save();renderSocial();
}
function removeCustomSocial(id){
  data.customSocialItems=data.customSocialItems.filter(function(i){return i.id!==id});
  save();renderSocial();
}
function logIGFollowers(){
  const inp=document.getElementById('ig-follower-input');
  const count=parseInt(inp.value);if(isNaN(count))return;
  if(!data.igFollowers)data.igFollowers=[];
  data.igFollowers.push({count:count,date:todayStr()});
  save();renderSocial();
}
function saveFBGroup(){
  const name=document.getElementById('group-name').value.trim();
  const url=document.getElementById('group-url').value.trim();
  if(!name){alert('Group name is required');return}
  if(!data.fbGroups)data.fbGroups=[];
  data.fbGroups.push({id:uid(),name:name,url:url});
  save();closeModal('groupModal');renderSocial();
}
function removeFBGroup(id){
  data.fbGroups=data.fbGroups.filter(function(g){return g.id!==id});
  save();renderSocial();
}
function logLIConnections(){
  const inp=document.getElementById('li-connection-input');
  const count=parseInt(inp.value);if(isNaN(count))return;
  if(!data.liFollowers)data.liFollowers=[];
  data.liFollowers.push({count:count,date:todayStr()});
  save();renderSocial();
}

/* ========== RENDER: VAULT ========== */
let vaultSearch='';
let vaultTagFilter='All';
let vaultViewId=null;
const VAULT_TAGS=['Objection','Email','Script','Insight','Lesson','Idea','Quote','Competitor'];
const VAULT_TAG_CLASS={Objection:'vt-objection',Email:'vt-email',Script:'vt-script',Insight:'vt-insight',Lesson:'vt-lesson',Idea:'vt-idea',Quote:'vt-quote',Competitor:'vt-competitor'};

function renderVault(){
  const v=document.getElementById('view-vault');
  let h=buildSectionHero('sh-vault','&#128274;','The Vault','Insights, scripts, and weapons for the mission.','<button class="btn btn-gold" style="font-size:12px" onclick="openVaultModal()">+ Add Entry</button>');

  // If viewing a single entry
  if(vaultViewId){
    const entry=data.vault.find(function(e){return e.id===vaultViewId});
    if(entry){
      h+='<div style="margin-bottom:12px"><button class="btn btn-outline" style="font-size:12px" onclick="vaultViewId=null;renderVault()">&larr; Back to Vault</button></div>';
      h+='<div class="vault-full">';
      h+='<div style="display:flex;justify-content:space-between;align-items:flex-start">';
      h+='<h3 style="color:var(--gold);margin:0">'+esc(entry.title)+'</h3>';
      h+='<button class="btn btn-outline" style="font-size:11px;padding:4px 10px" onclick="openVaultModal(\''+entry.id+'\')">Edit</button>';
      h+='</div>';
      h+='<div class="ve-tags" style="margin:10px 0">';
      (entry.tags||[]).forEach(function(t){h+='<span class="ve-tag '+(VAULT_TAG_CLASS[t]||'')+'">'+esc(t)+'</span>'});
      h+='</div>';
      h+='<div class="vf-content">'+esc(entry.content)+'</div>';
      if(entry.source)h+='<div style="font-size:12px;color:var(--dim);margin-top:12px">Source: '+esc(entry.source)+'</div>';
      h+='<div style="font-size:11px;color:var(--dim);margin-top:8px">Added '+fmtDate(entry.date)+'</div>';
      h+='</div>';
      v.innerHTML=h;return;
    }
    vaultViewId=null;
  }

  // Search
  h+='<div style="margin-bottom:16px"><input type="text" id="vault-search" placeholder="Search the Vault..." value="'+esc(vaultSearch)+'" oninput="vaultSearch=this.value;renderVault()" style="width:100%;padding:10px 14px;background:var(--surface2);border:1px solid var(--border);border-radius:8px;color:var(--text);font-size:14px"></div>';

  // Tag filters
  h+='<div class="net-filters" style="margin-bottom:16px">';
  h+='<button class="'+(vaultTagFilter==='All'?'active':'')+'" onclick="vaultTagFilter=\'All\';renderVault()">All</button>';
  VAULT_TAGS.forEach(function(t){
    h+='<button class="'+(vaultTagFilter===t?'active':'')+'" onclick="vaultTagFilter=\''+t+'\';renderVault()">'+t+'</button>';
  });
  h+='</div>';

  // Filter entries
  var entries=data.vault.slice().sort(function(a,b){return b.date>a.date?1:-1});
  if(vaultTagFilter!=='All'){
    entries=entries.filter(function(e){return e.tags&&e.tags.indexOf(vaultTagFilter)!==-1});
  }
  if(vaultSearch){
    const q=vaultSearch.toLowerCase();
    entries=entries.filter(function(e){
      return (e.title&&e.title.toLowerCase().indexOf(q)!==-1)||
             (e.content&&e.content.toLowerCase().indexOf(q)!==-1)||
             (e.source&&e.source.toLowerCase().indexOf(q)!==-1);
    });
  }

  // Stats
  h+='<div style="display:flex;gap:12px;margin-bottom:16px;flex-wrap:wrap">';
  h+='<div class="card" style="flex:1;min-width:100px;text-align:center;padding:12px"><div style="font-size:28px;font-weight:800;color:var(--gold)">'+data.vault.length+'</div><div style="font-size:11px;color:var(--dim)">Total Entries</div></div>';
  var tagCounts={};VAULT_TAGS.forEach(function(t){tagCounts[t]=0});
  data.vault.forEach(function(e){(e.tags||[]).forEach(function(t){if(tagCounts[t]!==undefined)tagCounts[t]++})});
  var topTag='';var topCount=0;
  VAULT_TAGS.forEach(function(t){if(tagCounts[t]>topCount){topCount=tagCounts[t];topTag=t}});
  h+='<div class="card" style="flex:1;min-width:100px;text-align:center;padding:12px"><div style="font-size:28px;font-weight:800;color:var(--violet)">'+(topTag||'--')+'</div><div style="font-size:11px;color:var(--dim)">Top Category</div></div>';
  h+='</div>';

  // Entry list
  if(entries.length===0){
    h+='<div class="empty">Your Vault is empty. Start collecting insights, scripts, objection responses, and ideas.</div>';
  }else{
    entries.forEach(function(e){
      h+='<div class="vault-entry" onclick="vaultViewId=\''+e.id+'\';renderVault()">';
      h+='<div class="ve-title">'+esc(e.title)+'</div>';
      h+='<div class="ve-preview">'+esc((e.content||'').substring(0,120))+(e.content&&e.content.length>120?'...':'')+'</div>';
      h+='<div class="ve-tags">';
      (e.tags||[]).forEach(function(t){h+='<span class="ve-tag '+(VAULT_TAG_CLASS[t]||'')+'">'+esc(t)+'</span>'});
      h+='</div>';
      h+='<div class="ve-date">'+fmtDate(e.date)+'</div>';
      h+='</div>';
    });
  }
  v.innerHTML=h;
}

function openVaultModal(editId){
  const modal=document.getElementById('vaultModal');
  document.getElementById('vault-edit-id').value=editId||'';
  document.getElementById('vault-modal-title').textContent=editId?'Edit Vault Entry':'Add to Vault';
  document.getElementById('vault-delete-btn').style.display=editId?'inline-block':'none';
  if(editId){
    const entry=data.vault.find(function(e){return e.id===editId});
    if(entry){
      document.getElementById('vault-title').value=entry.title||'';
      document.getElementById('vault-content').value=entry.content||'';
      document.getElementById('vault-source').value=entry.source||'';
      renderVaultTagPicker(entry.tags||[]);
    }
  }else{
    document.getElementById('vault-title').value='';
    document.getElementById('vault-content').value='';
    document.getElementById('vault-source').value='';
    renderVaultTagPicker([]);
  }
  openModal('vaultModal');
}

var _vaultSelectedTags=[];
function renderVaultTagPicker(selected){
  _vaultSelectedTags=selected.slice();
  const picker=document.getElementById('vault-tag-picker');
  var h='';
  VAULT_TAGS.forEach(function(t){
    var isActive=_vaultSelectedTags.indexOf(t)!==-1;
    h+='<span class="ve-tag '+(VAULT_TAG_CLASS[t]||'')+'" style="cursor:pointer;padding:4px 10px;font-size:11px;'+(isActive?'box-shadow:0 0 0 2px var(--text)':' opacity:0.4')+'" onclick="toggleVaultTag(\''+t+'\')">'+t+'</span>';
  });
  picker.innerHTML=h;
}
function toggleVaultTag(tag){
  var idx=_vaultSelectedTags.indexOf(tag);
  if(idx===-1)_vaultSelectedTags.push(tag);
  else _vaultSelectedTags.splice(idx,1);
  renderVaultTagPicker(_vaultSelectedTags);
}

function saveVaultEntry(){
  const editId=document.getElementById('vault-edit-id').value;
  const title=document.getElementById('vault-title').value.trim();
  const content=document.getElementById('vault-content').value.trim();
  const source=document.getElementById('vault-source').value.trim();
  if(!title){alert('Title is required');return}
  if(!content){alert('Content is required');return}
  if(editId){
    const entry=data.vault.find(function(e){return e.id===editId});
    if(entry){entry.title=title;entry.content=content;entry.source=source;entry.tags=_vaultSelectedTags.slice()}
  }else{
    data.vault.push({id:uid(),title:title,content:content,source:source,tags:_vaultSelectedTags.slice(),date:todayStr()});
  }
  save();closeModal('vaultModal');renderVault();
}

function deleteVaultEntry(){
  const editId=document.getElementById('vault-edit-id').value;
  if(!editId)return;
  if(!confirm('Delete this Vault entry?'))return;
  data.vault=data.vault.filter(function(e){return e.id!==editId});
  vaultViewId=null;
  save();closeModal('vaultModal');renderVault();
}

/* ========== RENDER: TIME MACHINE ========== */
function renderTimeMachine(){
  const v=document.getElementById('view-timemachine');
  const tm=data.timeMachine;
  const today=new Date();
  const target=new Date(tm.targetDate);
  const daysLeft=Math.max(0,Math.ceil((target-today)/(86400000)));

  // Get current client count from HQ
  var hq;try{hq=JSON.parse(localStorage.getItem(HQ_KEY))}catch(e){}
  var currentClients=0;
  var currentMRR=0;
  if(hq&&hq.contacts){
    var closedContacts=hq.contacts.filter(function(c){return c.status==='Closed'});
    currentClients=closedContacts.length;
    closedContacts.forEach(function(c){
      if(c.customPrice>0){currentMRR+=Number(c.customPrice);}
      else{var sz=parseInt(c.crewSize)||8;currentMRR+=sz<=8?299:299+(sz-8)*30;}
    });
  }

  let h=buildSectionHero('sh-timemachine','&#9203;','Time Machine','The clock is ticking. Make every day count.','<button class="btn btn-outline" style="font-size:12px" onclick="openTMSettings()">&#9881; Settings</button>');

  // Countdown
  h+='<div class="tm-countdown">';
  h+='<div class="tm-days">'+daysLeft+'</div>';
  h+='<div class="tm-days-label">DAYS LEFT</div>';
  h+='<div class="tm-target">Target: <strong>'+tm.targetClients+' clients</strong> by <strong>'+fmtDate(tm.targetDate)+'</strong> &mdash; <strong>$'+tm.targetMRR.toLocaleString()+' MRR</strong></div>';
  h+='</div>';

  // Current stats
  h+='<div style="display:flex;gap:12px;margin-bottom:16px;flex-wrap:wrap">';
  h+='<div class="card" style="flex:1;min-width:100px;text-align:center;padding:16px"><div style="font-size:36px;font-weight:800;color:var(--gold)">'+currentClients+'</div><div style="font-size:12px;color:var(--dim)">Current Clients</div></div>';
  h+='<div class="card" style="flex:1;min-width:100px;text-align:center;padding:16px"><div style="font-size:36px;font-weight:800;color:var(--emerald)">$'+currentMRR.toLocaleString()+'</div><div style="font-size:12px;color:var(--dim)">Current MRR</div></div>';
  var remaining=Math.max(0,tm.targetClients-currentClients);
  h+='<div class="card" style="flex:1;min-width:100px;text-align:center;padding:16px"><div style="font-size:36px;font-weight:800;color:var(--sky)">'+remaining+'</div><div style="font-size:12px;color:var(--dim)">Clients Needed</div></div>';
  h+='</div>';

  // Pace indicator
  var totalDays=Math.max(1,Math.ceil((target-new Date(2026,1,1))/(86400000)));
  var daysPassed=totalDays-daysLeft;
  var expectedByNow=daysPassed>0?Math.round((tm.targetClients/totalDays)*daysPassed):0;
  var pace='';var paceDetail='';
  if(currentClients>expectedByNow){pace='ahead';paceDetail='You have '+currentClients+' clients — expected '+expectedByNow+' by now. Keep crushing it!';}
  else if(currentClients===expectedByNow){pace='on-track';paceDetail='Right on pace with '+currentClients+' clients. Stay focused.';}
  else{pace='behind';paceDetail='You have '+currentClients+' of '+expectedByNow+' expected clients. Time to accelerate!';}

  h+='<div class="tm-pace '+pace+'">';
  h+='<div class="pace-label">'+(pace==='ahead'?'&#128640; AHEAD OF SCHEDULE':pace==='on-track'?'&#9989; ON TRACK':'&#9888; BEHIND PACE')+'</div>';
  h+='<div class="pace-detail">'+paceDetail+'</div>';
  h+='</div>';

  // Weekly breakdown - clients needed per week
  var weeksLeft=Math.max(1,Math.ceil(daysLeft/7));
  var clientsPerWeek=(remaining/weeksLeft).toFixed(1);
  h+='<div class="card" style="margin-bottom:16px"><h3 style="color:var(--gold)">&#128202; Weekly Breakdown</h3>';
  h+='<div style="font-size:14px;color:var(--dim);margin-bottom:12px">You need <strong style="color:var(--gold)">'+clientsPerWeek+' new clients per week</strong> across '+weeksLeft+' weeks to hit your target.</div>';

  // Progress bar to goal
  var pct=Math.min(100,Math.round((currentClients/tm.targetClients)*100));
  h+='<div style="margin-bottom:16px">';
  h+='<div style="display:flex;justify-content:space-between;font-size:12px;color:var(--dim);margin-bottom:4px"><span>Progress to '+tm.targetClients+' clients</span><span>'+pct+'%</span></div>';
  h+='<div style="height:10px;background:rgba(255,255,255,0.06);border-radius:5px;overflow:hidden">';
  h+='<div style="height:100%;width:'+pct+'%;background:linear-gradient(90deg,var(--gold),var(--emerald));border-radius:5px;transition:width .5s"></div>';
  h+='</div></div>';

  // MRR progress bar
  var mrrPct=Math.min(100,Math.round((currentMRR/tm.targetMRR)*100));
  h+='<div>';
  h+='<div style="display:flex;justify-content:space-between;font-size:12px;color:var(--dim);margin-bottom:4px"><span>Progress to $'+tm.targetMRR.toLocaleString()+' MRR</span><span>'+mrrPct+'%</span></div>';
  h+='<div style="height:10px;background:rgba(255,255,255,0.06);border-radius:5px;overflow:hidden">';
  h+='<div style="height:100%;width:'+mrrPct+'%;background:linear-gradient(90deg,var(--emerald),var(--sky));border-radius:5px;transition:width .5s"></div>';
  h+='</div></div>';
  h+='</div>';

  // Monthly milestones
  h+='<div class="card"><h3 style="color:var(--gold)">&#127919; Monthly Milestones</h3>';
  h+='<div class="tm-milestones">';
  var startMonth=1;// Feb 2026
  var targetMonth=new Date(tm.targetDate).getMonth();
  var targetYear=new Date(tm.targetDate).getFullYear();
  var totalMonths=0;
  for(var y=2026;y<=targetYear;y++){
    var mStart=(y===2026)?startMonth:0;
    var mEnd=(y===targetYear)?targetMonth:11;
    for(var m=mStart;m<=mEnd;m++){
      totalMonths++;
    }
  }
  var milestonesPerMonth=tm.targetClients/Math.max(1,totalMonths);
  var monthIdx=0;
  for(var y2=2026;y2<=targetYear;y2++){
    var ms2=(y2===2026)?startMonth:0;
    var me2=(y2===targetYear)?targetMonth:11;
    for(var m2=ms2;m2<=me2;m2++){
      monthIdx++;
      var mileTarget=Math.round(milestonesPerMonth*monthIdx);
      var now=new Date();
      var isCurrent=(now.getFullYear()===y2&&now.getMonth()===m2);
      var isPast=new Date(y2,m2+1,0)<now;
      var hitClass=isPast&&currentClients>=mileTarget?'hit':(isCurrent?'current':'');
      h+='<div class="tm-mile '+hitClass+'">';
      h+='<div class="month-name">'+MONTHS[m2].slice(0,3)+'</div>';
      h+='<div class="month-target">'+mileTarget+'</div>';
      h+='</div>';
    }
  }
  h+='</div></div>';

  // Motivational section
  var quotes=[
    'The distance between your dreams and reality is called action.',
    'Every master was once a disaster. Keep going.',
    'You don\'t need more time. You need more focus.',
    'The best time to plant a tree was 20 years ago. The second best time is now.',
    'Success is rented, and the rent is due every day.',
    'Small daily improvements are the key to staggering long-term results.',
    'Outwork everyone. It\'s the one thing you can always control.',
    'The person who says it cannot be done should not interrupt the person doing it.'
  ];
  var quoteIdx=Math.floor(daysBetween('2026-01-01',todayStr()))%quotes.length;
  h+='<div class="card" style="text-align:center;border-color:rgba(255,179,0,0.15)">';
  h+='<div style="font-size:15px;color:var(--text);font-style:italic;line-height:1.6">"'+quotes[quoteIdx]+'"</div>';
  h+='</div>';

  v.innerHTML=h;
}

function openTMSettings(){
  document.getElementById('tm-target-date').value=data.timeMachine.targetDate;
  document.getElementById('tm-target-clients').value=data.timeMachine.targetClients;
  document.getElementById('tm-target-mrr').value=data.timeMachine.targetMRR;
  openModal('tmModal');
}

function saveTMSettings(){
  data.timeMachine.targetDate=document.getElementById('tm-target-date').value;
  data.timeMachine.targetClients=parseInt(document.getElementById('tm-target-clients').value)||50;
  data.timeMachine.targetMRR=parseInt(document.getElementById('tm-target-mrr').value)||17500;
  save();closeModal('tmModal');renderTimeMachine();
}

/* ========== RENDER: WINS ========== */
let winFilter='All';
function renderWins(){
  const v=document.getElementById('view-wins');
  const cats=['All','Sale','Network','Learning','Social','Personal'];
  let h=buildSectionHero('sh-wins','&#127942;','Wins','Every victory counts. Even the small ones.','<button class="btn btn-gold" style="font-size:12px" onclick="openModal(\'winModal\')">+ Log a Win</button>');
  // Streak
  const streak=calcWinStreak();
  h+='<div class="streak-bar" style="margin-bottom:16px"><span class="streak-fire">&#127942;</span><span class="streak-num">'+streak+'</span><span class="streak-label">day win streak</span></div>';
  // Totals
  const totals={};cats.slice(1).forEach(function(c){totals[c]=data.wins.filter(function(w){return w.category===c}).length});
  h+='<div class="win-totals">';
  cats.slice(1).forEach(function(c){
    const colors={Sale:'var(--gold)',Network:'var(--violet)',Learning:'var(--sky)',Social:'var(--rose)',Personal:'var(--emerald)'};
    h+='<div class="wt" style="border-left:3px solid '+(colors[c]||'var(--dim)')+'">'+c+': '+totals[c]+'</div>';
  });
  h+='</div>';
  // Filter
  h+='<div class="net-filters" style="margin-bottom:16px">';
  cats.forEach(function(c){h+='<button class="'+(winFilter===c?'active':'')+'" onclick="winFilter=\''+c+'\';renderWins()">'+c+'</button>'});
  h+='</div>';
  // Win list
  let wins=data.wins.slice().sort(function(a,b){return b.date>a.date?1:-1});
  if(winFilter!=='All')wins=wins.filter(function(w){return w.category===winFilter});
  if(wins.length===0){
    h+='<div class="empty">No wins yet. Go make something happen!</div>';
  }else{
    const icons={Sale:'&#128176;',Network:'&#129309;',Learning:'&#128218;',Social:'&#128241;',Personal:'&#11088;'};
    const colors={Sale:'var(--gold)',Network:'var(--violet)',Learning:'var(--sky)',Social:'var(--rose)',Personal:'var(--emerald)'};
    wins.forEach(function(w){
      h+='<div class="win-item"><div class="win-icon">'+(icons[w.category]||'&#127942;')+'</div>';
      h+='<div class="win-body"><div class="win-desc">'+esc(w.description)+'</div>';
      h+='<div class="win-meta">'+fmtDate(w.date)+'<span class="win-cat" style="background:rgba(255,255,255,0.05);color:'+(colors[w.category]||'var(--dim)')+'">'+esc(w.category)+'</span></div>';
      h+='</div></div>';
    });
  }
  v.innerHTML=h;
}
function saveWin(){
  const desc=document.getElementById('win-desc').value.trim();
  const cat=document.getElementById('win-category').value;
  if(!desc){alert('Describe your win!');return}
  data.wins.push({id:uid(),description:desc,category:cat,date:todayStr()});
  save();closeModal('winModal');launchConfetti();renderWins();
}
function calcWinStreak(){
  let streak=0;const d=new Date();
  for(let i=0;i<365;i++){
    const ds=d.toISOString().slice(0,10);
    const hasWin=data.wins.some(function(w){return w.date===ds});
    if(hasWin)streak++;else if(i>0)break;
    d.setDate(d.getDate()-1);
  }
  return streak;
}

/* ========== NAV & MODALS ========== */
let currentView='today';
function switchView(view){
  currentView=view;
  document.querySelectorAll('.view').forEach(function(v){v.classList.remove('active')});
  document.querySelectorAll('.nav-links a').forEach(function(a){a.classList.remove('active')});
  document.getElementById('view-'+view).classList.add('active');
  document.getElementById('nav-'+view).classList.add('active');
  const renderers={today:renderToday,alfred:renderAlfred,network:renderNetwork,learn:renderLearn,social:renderSocial,vault:renderVault,timemachine:renderTimeMachine,wins:renderWins};
  if(renderers[view])renderers[view]();
}
function openModal(id){document.getElementById(id).classList.add('active')}
function closeModal(id){document.getElementById(id).classList.remove('active')}

/* ========== SETTINGS ========== */
function saveSettings(){
  data.settings.linkedin=document.getElementById('set-linkedin').value.trim();
  data.settings.instagram=document.getElementById('set-instagram').value.trim();
  data.settings.facebook=document.getElementById('set-facebook').value.trim();
  data.settings.emailTarget=parseInt(document.getElementById('set-emails').value)||50;
  data.settings.callTarget=parseInt(document.getElementById('set-calls').value)||20;
  data.settings.dmTarget=parseInt(document.getElementById('set-dms').value)||15;
  save();closeModal('settingsModal');renderToday();
}
function loadSettingsToModal(){
  document.getElementById('set-linkedin').value=data.settings.linkedin||'';
  document.getElementById('set-instagram').value=data.settings.instagram||'';
  document.getElementById('set-facebook').value=data.settings.facebook||'';
  document.getElementById('set-emails').value=data.settings.emailTarget||50;
  document.getElementById('set-calls').value=data.settings.callTarget||20;
  document.getElementById('set-dms').value=data.settings.dmTarget||15;
}

/* ========== STREAK CALCULATION ========== */
function updateStreak(){
  const yesterday=new Date();yesterday.setDate(yesterday.getDate()-1);
  const ys=yesterday.toISOString().slice(0,10);
  const yStats=data.dailyStats[ys];
  if(yStats){
    const et=data.settings.emailTarget||50;const ct=data.settings.callTarget||20;const dt=data.settings.dmTarget||15;
    if(yStats.emails>=et&&yStats.calls>=ct&&yStats.linkedin>=dt){
      // Streak maintained (simplified)
    }
  }
}

/* ========== THEME TOGGLE ========== */
function applyTheme(){
  const isLight=data.settings.theme==='light';
  document.body.classList.toggle('light-mode',isLight);
  const btn=document.getElementById('theme-toggle');
  if(btn)btn.innerHTML=isLight?'&#9728;':'&#9790;';
  const meta=document.querySelector('meta[name="theme-color"]');
  if(meta)meta.content=isLight?'#f4f5f7':'#0f1117';
}
function toggleTheme(){
  data.settings.theme=data.settings.theme==='light'?'dark':'light';
  save();applyTheme();
}

/* ========== INIT ========== */
data=loadData();
if(!data.settings.theme)data.settings.theme='dark';
applyTheme();
document.addEventListener('DOMContentLoaded',function(){
  loadSettingsToModal();
  applyTheme();
  renderToday();
});
// Keyboard shortcut for Alfred gameplan
document.addEventListener('keydown',function(e){
  if(e.key==='/'&&!['INPUT','TEXTAREA','SELECT'].includes(document.activeElement.tagName)){
    e.preventDefault();switchView('alfred');
  }
});
</script>
</body>
</html>
